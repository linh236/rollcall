{"version":3,"file":"js/ccv-281470b3aa551c35b7d3.js","sources":["webpack:///webpack/bootstrap","webpack:///./app/javascript/packs/ccv.js"],"sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/packs/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./app/javascript/packs/ccv.js\");\n","/*\nCopyright (c) 2010, Liu Liu\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:\n\n* Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.\n* Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.\n* Neither the name of the authors nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.\n*/\n\n/* Added by Jay Salvat: Get Script Path */\ntry {\n    var getScriptPath = function () {\n    \t\"use strict\";\n\n        var scripts = document.getElementsByTagName('script');\n\n        for (var i = 0; i < scripts.length; i++) {\n            if (scripts[i].src.match(/(jquery\\.facedetection(\\.min)?\\.js)|\\/ccv\\.js/)) {\n                return scripts[i].src;\n            }\n        }\n    };\n\n    var scriptPath = getScriptPath();\n} catch (e) {}\n/* End Jay Salvat */\n\nif (parallable === undefined) {\n\tvar parallable = function (file, funct) {\n\t\t\"use strict\";\n\n\t\tparallable.core[funct.toString()] = funct().core;\n\n\t\treturn function () {\n\t\t\tvar i;\n\t\t\tvar async, worker_num, params;\n\t\t\tif (arguments.length > 1) {\n\t\t\t\tasync = arguments[arguments.length - 2];\n\t\t\t\tworker_num = arguments[arguments.length - 1];\n\t\t\t\tparams = new Array(arguments.length - 2);\n\t\t\t\tfor (i = 0; i < arguments.length - 2; i++)\n\t\t\t\t\tparams[i] = arguments[i];\n\t\t\t} else {\n\t\t\t\tasync = arguments[0].async;\n\t\t\t\tworker_num = arguments[0].worker;\n\t\t\t\tparams = arguments[0];\n\t\t\t\tdelete params[\"async\"];\n\t\t\t\tdelete params[\"worker\"];\n\t\t\t\tparams = [params];\n\t\t\t}\n\t\t\tvar scope = { \"shared\" : {} };\n\t\t\tvar ctrl = funct.apply(scope, params);\n\t\t\tif (async) {\n\t\t\t\treturn function (complete, error) {\n\t\t\t\t\tvar executed = 0;\n\t\t\t\t\tvar outputs = new Array(worker_num);\n\t\t\t\t\tvar inputs = ctrl.pre.apply(scope, [worker_num]);\n\t\t\t\t\t/* sanitize scope shared because for Chrome/WebKit, worker only support JSONable data */\n\t\t\t\t\tfor (i in scope.shared)\n\t\t\t\t\t\t/* delete function, if any */\n\t\t\t\t\t\tif (typeof scope.shared[i] == \"function\")\n\t\t\t\t\t\t\tdelete scope.shared[i];\n\t\t\t\t\t\t/* delete DOM object, if any */\n\t\t\t\t\t\telse if (scope.shared[i].tagName !== undefined)\n\t\t\t\t\t\t\tdelete scope.shared[i];\n\t\t\t\t\tfor (i = 0; i < worker_num; i++) {\n\t\t\t\t\t\tvar worker = new Worker(file);\n\t\t\t\t\t\tworker.onmessage = (function (i) {\n\t\t\t\t\t\t\treturn function (event) {\n\t\t\t\t\t\t\t\toutputs[i] = (typeof event.data == \"string\") ? JSON.parse(event.data) : event.data;\n\t\t\t\t\t\t\t\texecuted++;\n\t\t\t\t\t\t\t\tif (executed == worker_num)\n\t\t\t\t\t\t\t\t\tcomplete(ctrl.post.apply(scope, [outputs]));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})(i);\n\t\t\t\t\t\tvar msg = { \"input\" : inputs[i],\n\t\t\t\t\t\t\t\t\t\"name\" : funct.toString(),\n\t\t\t\t\t\t\t\t\t\"shared\" : scope.shared,\n\t\t\t\t\t\t\t\t\t\"id\" : i,\n\t\t\t\t\t\t\t\t\t\"worker\" : params.worker_num,\n                  \"from\" : \"jquery.facedetection\" };\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tworker.postMessage(msg);\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tworker.postMessage(JSON.stringify(msg));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn ctrl.post.apply(scope, [[ctrl.core.apply(scope, [ctrl.pre.apply(scope, [1])[0], 0, 1])]]);\n\t\t\t}\n\t\t}\n\t};\n\tparallable.core = {};\n}\n\nfunction get_named_arguments(params, names) {\n\tif (params.length > 1) {\n\t\tvar new_params = {};\n\t\tfor (var i = 0; i < names.length; i++)\n\t\t\tnew_params[names[i]] = params[i];\n\t\treturn new_params;\n\t} else if (params.length == 1) {\n\t\treturn params[0];\n\t} else {\n\t\treturn {};\n\t}\n}\n\nvar ccv = {\n\tpre : function (image) {\n\t\tif (image.tagName.toLowerCase() == \"img\") {\n\t\t\tvar canvas = document.createElement(\"canvas\");\n\t\t\tdocument.body.appendChild(image);\n\t\t\tcanvas.width = image.offsetWidth;\n\t\t\tcanvas.style.width = image.offsetWidth.toString() + \"px\";\n\t\t\tcanvas.height = image.offsetHeight;\n\t\t\tcanvas.style.height = image.offsetHeight.toString() + \"px\";\n\t\t\tdocument.body.removeChild(image);\n\t\t\tvar ctx = canvas.getContext(\"2d\");\n\t\t\tctx.drawImage(image, 0, 0);\n\t\t\treturn canvas;\n\t\t}\n\t\treturn image;\n\t},\n\n\tgrayscale : function (canvas) {\n\t\tvar ctx = canvas.getContext(\"2d\");\n\t\tvar imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n\t\tvar data = imageData.data;\n\t\tvar pix1, pix2, pix = canvas.width * canvas.height * 4;\n\t\twhile (pix > 0)\n\t\t\tdata[pix -= 4] = data[pix1 = pix + 1] = data[pix2 = pix + 2] = (data[pix] * 0.3 + data[pix1] * 0.59 + data[pix2] * 0.11);\n\t\tctx.putImageData(imageData, 0, 0);\n\t\treturn canvas;\n\t},\n\n\tarray_group : function (seq, gfunc) {\n\t\tvar i, j;\n\t\tvar node = new Array(seq.length);\n\t\tfor (i = 0; i < seq.length; i++)\n\t\t\tnode[i] = {\"parent\" : -1,\n\t\t\t\t\t   \"element\" : seq[i],\n\t\t\t\t\t   \"rank\" : 0};\n\t\tfor (i = 0; i < seq.length; i++) {\n\t\t\tif (!node[i].element)\n\t\t\t\tcontinue;\n\t\t\tvar root = i;\n\t\t\twhile (node[root].parent != -1)\n\t\t\t\troot = node[root].parent;\n\t\t\tfor (j = 0; j < seq.length; j++) {\n\t\t\t\tif( i != j && node[j].element && gfunc(node[i].element, node[j].element)) {\n\t\t\t\t\tvar root2 = j;\n\n\t\t\t\t\twhile (node[root2].parent != -1)\n\t\t\t\t\t\troot2 = node[root2].parent;\n\n\t\t\t\t\tif(root2 != root) {\n\t\t\t\t\t\tif(node[root].rank > node[root2].rank)\n\t\t\t\t\t\t\tnode[root2].parent = root;\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tnode[root].parent = root2;\n\t\t\t\t\t\t\tif (node[root].rank == node[root2].rank)\n\t\t\t\t\t\t\tnode[root2].rank++;\n\t\t\t\t\t\t\troot = root2;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* compress path from node2 to the root: */\n\t\t\t\t\t\tvar temp, node2 = j;\n\t\t\t\t\t\twhile (node[node2].parent != -1) {\n\t\t\t\t\t\t\ttemp = node2;\n\t\t\t\t\t\t\tnode2 = node[node2].parent;\n\t\t\t\t\t\t\tnode[temp].parent = root;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* compress path from node to the root: */\n\t\t\t\t\t\tnode2 = i;\n\t\t\t\t\t\twhile (node[node2].parent != -1) {\n\t\t\t\t\t\t\ttemp = node2;\n\t\t\t\t\t\t\tnode2 = node[node2].parent;\n\t\t\t\t\t\t\tnode[temp].parent = root;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tvar idx = new Array(seq.length);\n\t\tvar class_idx = 0;\n\t\tfor(i = 0; i < seq.length; i++) {\n\t\t\tj = -1;\n\t\t\tvar node1 = i;\n\t\t\tif(node[node1].element) {\n\t\t\t\twhile (node[node1].parent != -1)\n\t\t\t\t\tnode1 = node[node1].parent;\n\t\t\t\tif(node[node1].rank >= 0)\n\t\t\t\t\tnode[node1].rank = ~class_idx++;\n\t\t\t\tj = ~node[node1].rank;\n\t\t\t}\n\t\t\tidx[i] = j;\n\t\t}\n\t\treturn {\"index\" : idx, \"cat\" : class_idx};\n\t},\n\n\tdetect_objects : parallable(scriptPath, function (canvas, cascade, interval, min_neighbors) {\n\t\tif (this.shared !== undefined) {\n\t\t\tvar params = get_named_arguments(arguments, [\"canvas\", \"cascade\", \"interval\", \"min_neighbors\"]);\n\t\t\tthis.shared.canvas = params.canvas;\n\t\t\tthis.shared.interval = params.interval;\n\t\t\tthis.shared.min_neighbors = params.min_neighbors;\n\t\t\tthis.shared.cascade = params.cascade;\n\t\t\tthis.shared.scale = Math.pow(2, 1 / (params.interval + 1));\n\t\t\tthis.shared.next = params.interval + 1;\n\t\t\tthis.shared.scale_upto = Math.floor(Math.log(Math.min(params.canvas.width / params.cascade.width, params.canvas.height / params.cascade.height)) / Math.log(this.shared.scale));\n\t\t\tvar i;\n\t\t\tfor (i = 0; i < this.shared.cascade.stage_classifier.length; i++)\n\t\t\t\tthis.shared.cascade.stage_classifier[i].orig_feature = this.shared.cascade.stage_classifier[i].feature;\n\t\t}\n\n\t\tfunction pre(worker_num) {\n\t\t\tvar canvas = this.shared.canvas;\n\t\t\tvar interval = this.shared.interval;\n\t\t\tvar scale = this.shared.scale;\n\t\t\tvar next = this.shared.next;\n\t\t\tvar scale_upto = this.shared.scale_upto;\n\t\t\tvar pyr = new Array((scale_upto + next * 2) * 4);\n\t\t\tvar ret = new Array((scale_upto + next * 2) * 4);\n\t\t\tpyr[0] = canvas;\n\t\t\tret[0] = { \"width\" : pyr[0].width,\n\t\t\t\t\t   \"height\" : pyr[0].height,\n\t\t\t\t\t   \"data\" : pyr[0].getContext(\"2d\").getImageData(0, 0, pyr[0].width, pyr[0].height).data };\n\t\t\tvar i;\n\t\t\tfor (i = 1; i <= interval; i++) {\n\t\t\t\tpyr[i * 4] = document.createElement(\"canvas\");\n\t\t\t\tpyr[i * 4].width = Math.floor(pyr[0].width / Math.pow(scale, i));\n\t\t\t\tpyr[i * 4].height = Math.floor(pyr[0].height / Math.pow(scale, i));\n\t\t\t\tpyr[i * 4].getContext(\"2d\").drawImage(pyr[0], 0, 0, pyr[0].width, pyr[0].height, 0, 0, pyr[i * 4].width, pyr[i * 4].height);\n\t\t\t\tret[i * 4] = { \"width\" : pyr[i * 4].width,\n\t\t\t\t\t\t\t   \"height\" : pyr[i * 4].height,\n\t\t\t\t\t\t\t   \"data\" : pyr[i * 4].getContext(\"2d\").getImageData(0, 0, pyr[i * 4].width, pyr[i * 4].height).data };\n\t\t\t}\n\t\t\tfor (i = next; i < scale_upto + next * 2; i++) {\n\t\t\t\tpyr[i * 4] = document.createElement(\"canvas\");\n\t\t\t\tpyr[i * 4].width = Math.floor(pyr[i * 4 - next * 4].width / 2);\n\t\t\t\tpyr[i * 4].height = Math.floor(pyr[i * 4 - next * 4].height / 2);\n\t\t\t\tpyr[i * 4].getContext(\"2d\").drawImage(pyr[i * 4 - next * 4], 0, 0, pyr[i * 4 - next * 4].width, pyr[i * 4 - next * 4].height, 0, 0, pyr[i * 4].width, pyr[i * 4].height);\n\t\t\t\tret[i * 4] = { \"width\" : pyr[i * 4].width,\n\t\t\t\t\t\t\t   \"height\" : pyr[i * 4].height,\n\t\t\t\t\t\t\t   \"data\" : pyr[i * 4].getContext(\"2d\").getImageData(0, 0, pyr[i * 4].width, pyr[i * 4].height).data };\n\t\t\t}\n\t\t\tfor (i = next * 2; i < scale_upto + next * 2; i++) {\n\t\t\t\tpyr[i * 4 + 1] = document.createElement(\"canvas\");\n\t\t\t\tpyr[i * 4 + 1].width = Math.floor(pyr[i * 4 - next * 4].width / 2);\n\t\t\t\tpyr[i * 4 + 1].height = Math.floor(pyr[i * 4 - next * 4].height / 2);\n\t\t\t\tpyr[i * 4 + 1].getContext(\"2d\").drawImage(pyr[i * 4 - next * 4], 1, 0, pyr[i * 4 - next * 4].width - 1, pyr[i * 4 - next * 4].height, 0, 0, pyr[i * 4 + 1].width - 2, pyr[i * 4 + 1].height);\n\t\t\t\tret[i * 4 + 1] = { \"width\" : pyr[i * 4 + 1].width,\n\t\t\t\t\t\t\t\t   \"height\" : pyr[i * 4 + 1].height,\n\t\t\t\t\t\t\t\t   \"data\" : pyr[i * 4 + 1].getContext(\"2d\").getImageData(0, 0, pyr[i * 4 + 1].width, pyr[i * 4 + 1].height).data };\n\t\t\t\tpyr[i * 4 + 2] = document.createElement(\"canvas\");\n\t\t\t\tpyr[i * 4 + 2].width = Math.floor(pyr[i * 4 - next * 4].width / 2);\n\t\t\t\tpyr[i * 4 + 2].height = Math.floor(pyr[i * 4 - next * 4].height / 2);\n\t\t\t\tpyr[i * 4 + 2].getContext(\"2d\").drawImage(pyr[i * 4 - next * 4], 0, 1, pyr[i * 4 - next * 4].width, pyr[i * 4 - next * 4].height - 1, 0, 0, pyr[i * 4 + 2].width, pyr[i * 4 + 2].height - 2);\n\t\t\t\tret[i * 4 + 2] = { \"width\" : pyr[i * 4 + 2].width,\n\t\t\t\t\t\t\t\t   \"height\" : pyr[i * 4 + 2].height,\n\t\t\t\t\t\t\t\t   \"data\" : pyr[i * 4 + 2].getContext(\"2d\").getImageData(0, 0, pyr[i * 4 + 2].width, pyr[i * 4 + 2].height).data };\n\t\t\t\tpyr[i * 4 + 3] = document.createElement(\"canvas\");\n\t\t\t\tpyr[i * 4 + 3].width = Math.floor(pyr[i * 4 - next * 4].width / 2);\n\t\t\t\tpyr[i * 4 + 3].height = Math.floor(pyr[i * 4 - next * 4].height / 2);\n\t\t\t\tpyr[i * 4 + 3].getContext(\"2d\").drawImage(pyr[i * 4 - next * 4], 1, 1, pyr[i * 4 - next * 4].width - 1, pyr[i * 4 - next * 4].height - 1, 0, 0, pyr[i * 4 + 3].width - 2, pyr[i * 4 + 3].height - 2);\n\t\t\t\tret[i * 4 + 3] = { \"width\" : pyr[i * 4 + 3].width,\n\t\t\t\t\t\t\t\t   \"height\" : pyr[i * 4 + 3].height,\n\t\t\t\t\t\t\t\t   \"data\" : pyr[i * 4 + 3].getContext(\"2d\").getImageData(0, 0, pyr[i * 4 + 3].width, pyr[i * 4 + 3].height).data };\n\t\t\t}\n\t\t\treturn [ret];\n\t\t};\n\n\t\tfunction core(pyr, id, worker_num) {\n\t\t\tvar cascade = this.shared.cascade;\n\t\t\tvar interval = this.shared.interval;\n\t\t\tvar scale = this.shared.scale;\n\t\t\tvar next = this.shared.next;\n\t\t\tvar scale_upto = this.shared.scale_upto;\n\t\t\tvar i, j, k, x, y, q;\n\t\t\tvar scale_x = 1, scale_y = 1;\n\t\t\tvar dx = [0, 1, 0, 1];\n\t\t\tvar dy = [0, 0, 1, 1];\n\t\t\tvar seq = [];\n\t\t\tfor (i = 0; i < scale_upto; i++) {\n\t\t\t\tvar qw = pyr[i * 4 + next * 8].width - Math.floor(cascade.width / 4);\n\t\t\t\tvar qh = pyr[i * 4 + next * 8].height - Math.floor(cascade.height / 4);\n\t\t\t\tvar step = [pyr[i * 4].width * 4, pyr[i * 4 + next * 4].width * 4, pyr[i * 4 + next * 8].width * 4];\n\t\t\t\tvar paddings = [pyr[i * 4].width * 16 - qw * 16,\n\t\t\t\t\t\t\t\tpyr[i * 4 + next * 4].width * 8 - qw * 8,\n\t\t\t\t\t\t\t\tpyr[i * 4 + next * 8].width * 4 - qw * 4];\n\t\t\t\tfor (j = 0; j < cascade.stage_classifier.length; j++) {\n\t\t\t\t\tvar orig_feature = cascade.stage_classifier[j].orig_feature;\n\t\t\t\t\tvar feature = cascade.stage_classifier[j].feature = new Array(cascade.stage_classifier[j].count);\n\t\t\t\t\tfor (k = 0; k < cascade.stage_classifier[j].count; k++) {\n\t\t\t\t\t\tfeature[k] = {\"size\" : orig_feature[k].size,\n\t\t\t\t\t\t\t\t\t  \"px\" : new Array(orig_feature[k].size),\n\t\t\t\t\t\t\t\t\t  \"pz\" : new Array(orig_feature[k].size),\n\t\t\t\t\t\t\t\t\t  \"nx\" : new Array(orig_feature[k].size),\n\t\t\t\t\t\t\t\t\t  \"nz\" : new Array(orig_feature[k].size)};\n\t\t\t\t\t\tfor (q = 0; q < orig_feature[k].size; q++) {\n\t\t\t\t\t\t\tfeature[k].px[q] = orig_feature[k].px[q] * 4 + orig_feature[k].py[q] * step[orig_feature[k].pz[q]];\n\t\t\t\t\t\t\tfeature[k].pz[q] = orig_feature[k].pz[q];\n\t\t\t\t\t\t\tfeature[k].nx[q] = orig_feature[k].nx[q] * 4 + orig_feature[k].ny[q] * step[orig_feature[k].nz[q]];\n\t\t\t\t\t\t\tfeature[k].nz[q] = orig_feature[k].nz[q];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (q = 0; q < 4; q++) {\n\t\t\t\t\tvar u8 = [pyr[i * 4].data, pyr[i * 4 + next * 4].data, pyr[i * 4 + next * 8 + q].data];\n\t\t\t\t\tvar u8o = [dx[q] * 8 + dy[q] * pyr[i * 4].width * 8, dx[q] * 4 + dy[q] * pyr[i * 4 + next * 4].width * 4, 0];\n\t\t\t\t\tfor (y = 0; y < qh; y++) {\n\t\t\t\t\t\tfor (x = 0; x < qw; x++) {\n\t\t\t\t\t\t\tvar sum = 0;\n\t\t\t\t\t\t\tvar flag = true;\n\t\t\t\t\t\t\tfor (j = 0; j < cascade.stage_classifier.length; j++) {\n\t\t\t\t\t\t\t\tsum = 0;\n\t\t\t\t\t\t\t\tvar alpha = cascade.stage_classifier[j].alpha;\n\t\t\t\t\t\t\t\tvar feature = cascade.stage_classifier[j].feature;\n\t\t\t\t\t\t\t\tfor (k = 0; k < cascade.stage_classifier[j].count; k++) {\n\t\t\t\t\t\t\t\t\tvar feature_k = feature[k];\n\t\t\t\t\t\t\t\t\tvar p, pmin = u8[feature_k.pz[0]][u8o[feature_k.pz[0]] + feature_k.px[0]];\n\t\t\t\t\t\t\t\t\tvar n, nmax = u8[feature_k.nz[0]][u8o[feature_k.nz[0]] + feature_k.nx[0]];\n\t\t\t\t\t\t\t\t\tif (pmin <= nmax) {\n\t\t\t\t\t\t\t\t\t\tsum += alpha[k * 2];\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tvar f, shortcut = true;\n\t\t\t\t\t\t\t\t\t\tfor (f = 0; f < feature_k.size; f++) {\n\t\t\t\t\t\t\t\t\t\t\tif (feature_k.pz[f] >= 0) {\n\t\t\t\t\t\t\t\t\t\t\t\tp = u8[feature_k.pz[f]][u8o[feature_k.pz[f]] + feature_k.px[f]];\n\t\t\t\t\t\t\t\t\t\t\t\tif (p < pmin) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (p <= nmax) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tshortcut = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\tpmin = p;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tif (feature_k.nz[f] >= 0) {\n\t\t\t\t\t\t\t\t\t\t\t\tn = u8[feature_k.nz[f]][u8o[feature_k.nz[f]] + feature_k.nx[f]];\n\t\t\t\t\t\t\t\t\t\t\t\tif (n > nmax) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (pmin <= n) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tshortcut = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\tnmax = n;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tsum += (shortcut) ? alpha[k * 2 + 1] : alpha[k * 2];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (sum < cascade.stage_classifier[j].threshold) {\n\t\t\t\t\t\t\t\t\tflag = false;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (flag) {\n\t\t\t\t\t\t\t\tseq.push({\"x\" : (x * 4 + dx[q] * 2) * scale_x,\n\t\t\t\t\t\t\t\t\t\t  \"y\" : (y * 4 + dy[q] * 2) * scale_y,\n\t\t\t\t\t\t\t\t\t\t  \"width\" : cascade.width * scale_x,\n\t\t\t\t\t\t\t\t\t\t  \"height\" : cascade.height * scale_y,\n\t\t\t\t\t\t\t\t\t\t  \"neighbor\" : 1,\n\t\t\t\t\t\t\t\t\t\t  \"confidence\" : sum});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tu8o[0] += 16;\n\t\t\t\t\t\t\tu8o[1] += 8;\n\t\t\t\t\t\t\tu8o[2] += 4;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tu8o[0] += paddings[0];\n\t\t\t\t\t\tu8o[1] += paddings[1];\n\t\t\t\t\t\tu8o[2] += paddings[2];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tscale_x *= scale;\n\t\t\t\tscale_y *= scale;\n\t\t\t}\n\t\t\treturn seq;\n\t\t};\n\n\t\tfunction post(seq) {\n\t\t\tvar min_neighbors = this.shared.min_neighbors;\n\t\t\tvar cascade = this.shared.cascade;\n\t\t\tvar interval = this.shared.interval;\n\t\t\tvar scale = this.shared.scale;\n\t\t\tvar next = this.shared.next;\n\t\t\tvar scale_upto = this.shared.scale_upto;\n\t\t\tvar i, j;\n\t\t\tfor (i = 0; i < cascade.stage_classifier.length; i++)\n\t\t\t\tcascade.stage_classifier[i].feature = cascade.stage_classifier[i].orig_feature;\n\t\t\tseq = seq[0];\n\t\t\tif (!(min_neighbors > 0))\n\t\t\t\treturn seq;\n\t\t\telse {\n\t\t\t\tvar result = ccv.array_group(seq, function (r1, r2) {\n\t\t\t\t\tvar distance = Math.floor(r1.width * 0.25 + 0.5);\n\n\t\t\t\t\treturn r2.x <= r1.x + distance &&\n\t\t\t\t\t\t   r2.x >= r1.x - distance &&\n\t\t\t\t\t\t   r2.y <= r1.y + distance &&\n\t\t\t\t\t\t   r2.y >= r1.y - distance &&\n\t\t\t\t\t\t   r2.width <= Math.floor(r1.width * 1.5 + 0.5) &&\n\t\t\t\t\t\t   Math.floor(r2.width * 1.5 + 0.5) >= r1.width;\n\t\t\t\t});\n\t\t\t\tvar ncomp = result.cat;\n\t\t\t\tvar idx_seq = result.index;\n\t\t\t\tvar comps = new Array(ncomp + 1);\n\t\t\t\tfor (i = 0; i < comps.length; i++)\n\t\t\t\t\tcomps[i] = {\"neighbors\" : 0,\n\t\t\t\t\t\t\t\t\"x\" : 0,\n\t\t\t\t\t\t\t\t\"y\" : 0,\n\t\t\t\t\t\t\t\t\"width\" : 0,\n\t\t\t\t\t\t\t\t\"height\" : 0,\n\t\t\t\t\t\t\t\t\"confidence\" : 0};\n\n\t\t\t\t// count number of neighbors\n\t\t\t\tfor(i = 0; i < seq.length; i++)\n\t\t\t\t{\n\t\t\t\t\tvar r1 = seq[i];\n\t\t\t\t\tvar idx = idx_seq[i];\n\n\t\t\t\t\tif (comps[idx].neighbors == 0)\n\t\t\t\t\t\tcomps[idx].confidence = r1.confidence;\n\n\t\t\t\t\t++comps[idx].neighbors;\n\n\t\t\t\t\tcomps[idx].x += r1.x;\n\t\t\t\t\tcomps[idx].y += r1.y;\n\t\t\t\t\tcomps[idx].width += r1.width;\n\t\t\t\t\tcomps[idx].height += r1.height;\n\t\t\t\t\tcomps[idx].confidence = Math.max(comps[idx].confidence, r1.confidence);\n\t\t\t\t}\n\n\t\t\t\tvar seq2 = [];\n\t\t\t\t// calculate average bounding box\n\t\t\t\tfor(i = 0; i < ncomp; i++)\n\t\t\t\t{\n\t\t\t\t\tvar n = comps[i].neighbors;\n\t\t\t\t\tif (n >= min_neighbors)\n\t\t\t\t\t\tseq2.push({\"x\" : (comps[i].x * 2 + n) / (2 * n),\n\t\t\t\t\t\t\t\t   \"y\" : (comps[i].y * 2 + n) / (2 * n),\n\t\t\t\t\t\t\t\t   \"width\" : (comps[i].width * 2 + n) / (2 * n),\n\t\t\t\t\t\t\t\t   \"height\" : (comps[i].height * 2 + n) / (2 * n),\n\t\t\t\t\t\t\t\t   \"neighbors\" : comps[i].neighbors,\n\t\t\t\t\t\t\t\t   \"confidence\" : comps[i].confidence});\n\t\t\t\t}\n\n\t\t\t\tvar result_seq = [];\n\t\t\t\t// filter out small face rectangles inside large face rectangles\n\t\t\t\tfor(i = 0; i < seq2.length; i++)\n\t\t\t\t{\n\t\t\t\t\tvar r1 = seq2[i];\n\t\t\t\t\tvar flag = true;\n\t\t\t\t\tfor(j = 0; j < seq2.length; j++)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar r2 = seq2[j];\n\t\t\t\t\t\tvar distance = Math.floor(r2.width * 0.25 + 0.5);\n\n\t\t\t\t\t\tif(i != j &&\n\t\t\t\t\t\t   r1.x >= r2.x - distance &&\n\t\t\t\t\t\t   r1.y >= r2.y - distance &&\n\t\t\t\t\t\t   r1.x + r1.width <= r2.x + r2.width + distance &&\n\t\t\t\t\t\t   r1.y + r1.height <= r2.y + r2.height + distance &&\n\t\t\t\t\t\t   (r2.neighbors > Math.max(3, r1.neighbors) || r1.neighbors < 3))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tflag = false;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif(flag)\n\t\t\t\t\t\tresult_seq.push(r1);\n\t\t\t\t}\n\t\t\t\treturn result_seq;\n\t\t\t}\n\t\t};\n\t\treturn { \"pre\" : pre, \"core\" : core, \"post\" : post };\n\t})\n}\n\n// Monkey patch to avoid overriding window's onmessage handler.\nvar originalOnMessage = window.onmessage || function () {};\nonmessage = function (event) {\n  var data;\n  try {\n    data = (typeof event.data == \"string\") ? JSON.parse(event.data) : event.data;\n    if (data.type === \"jquery.facedetection\") {\n      // This is the event that is intended for jquery.facedetection\n      var scope = { \"shared\" : data.shared };\n      var result = parallable.core[data.name].apply(scope, [data.input, data.id, data.worker]);\n      try {\n        postMessage(result);\n      } catch (e) {\n        postMessage(JSON.stringify(result));\n      }\n    } else {\n      // Nope. This is not the event that should be handled by jquery.facedetection\n      var args = Array.prototype.slice.call(arguments);\n      originalOnMessage.apply(window, args);\n    }\n  } catch (e) {\n    // `event.data` is string, but too bad it is not in JSON format.\n    // so just pass it to window's original onmessage handler\n    var args = Array.prototype.slice.call(arguments);\n    originalOnMessage.apply(window, args);\n  }\n}\n"],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AClFA;;;;;;;;;;;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AADA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AAFA;AAFA;AACA;AAMA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AALA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AADA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAFA;AADA;AACA;AAGA;AACA;AAEA;AACA;AAAA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AAEA;AACA;AAGA;AACA;AAEA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AADA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AADA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAGA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAGA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAGA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAGA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAGA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAGA;AACA;AAAA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAJA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AALA;AAMA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AADA;AACA;AACA;AACA;AAGA;AACA;AAEA;AAMA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AALA;AADA;AACA;AACA;AAOA;AAEA;AACA;AAEA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAMA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AAOA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AADA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAlXA;AACA;AAqXA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}