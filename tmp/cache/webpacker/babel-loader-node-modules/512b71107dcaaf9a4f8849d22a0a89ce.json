{"ast":null,"code":"/*\nCopyright (c) 2010, Liu Liu\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:\n\n* Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.\n* Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.\n* Neither the name of the authors nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.\n*/\n\n/* Added by Jay Salvat: Get Script Path */\ntry {\n  var getScriptPath = function getScriptPath() {\n    \"use strict\";\n\n    var scripts = document.getElementsByTagName('script');\n\n    for (var i = 0; i < scripts.length; i++) {\n      if (scripts[i].src.match(/(jquery\\.facedetection(\\.min)?\\.js)|\\/ccv\\.js/)) {\n        return scripts[i].src;\n      }\n    }\n  };\n\n  var scriptPath = getScriptPath();\n} catch (e) {}\n/* End Jay Salvat */\n\n\nif (parallable === undefined) {\n  var parallable = function parallable(file, funct) {\n    \"use strict\";\n\n    parallable.core[funct.toString()] = funct().core;\n    return function () {\n      var i;\n      var async, worker_num, params;\n\n      if (arguments.length > 1) {\n        async = arguments[arguments.length - 2];\n        worker_num = arguments[arguments.length - 1];\n        params = new Array(arguments.length - 2);\n\n        for (i = 0; i < arguments.length - 2; i++) {\n          params[i] = arguments[i];\n        }\n      } else {\n        async = arguments[0].async;\n        worker_num = arguments[0].worker;\n        params = arguments[0];\n        delete params[\"async\"];\n        delete params[\"worker\"];\n        params = [params];\n      }\n\n      var scope = {\n        \"shared\": {}\n      };\n      var ctrl = funct.apply(scope, params);\n\n      if (async) {\n        return function (complete, error) {\n          var executed = 0;\n          var outputs = new Array(worker_num);\n          var inputs = ctrl.pre.apply(scope, [worker_num]);\n          /* sanitize scope shared because for Chrome/WebKit, worker only support JSONable data */\n\n          for (i in scope.shared) {\n            /* delete function, if any */\n            if (typeof scope.shared[i] == \"function\") delete scope.shared[i];\n            /* delete DOM object, if any */\n            else if (scope.shared[i].tagName !== undefined) delete scope.shared[i];\n          }\n\n          for (i = 0; i < worker_num; i++) {\n            var worker = new Worker(file);\n\n            worker.onmessage = function (i) {\n              return function (event) {\n                outputs[i] = typeof event.data == \"string\" ? JSON.parse(event.data) : event.data;\n                executed++;\n                if (executed == worker_num) complete(ctrl.post.apply(scope, [outputs]));\n              };\n            }(i);\n\n            var msg = {\n              \"input\": inputs[i],\n              \"name\": funct.toString(),\n              \"shared\": scope.shared,\n              \"id\": i,\n              \"worker\": params.worker_num,\n              \"from\": \"jquery.facedetection\"\n            };\n\n            try {\n              worker.postMessage(msg);\n            } catch (e) {\n              worker.postMessage(JSON.stringify(msg));\n            }\n          }\n        };\n      } else {\n        return ctrl.post.apply(scope, [[ctrl.core.apply(scope, [ctrl.pre.apply(scope, [1])[0], 0, 1])]]);\n      }\n    };\n  };\n\n  parallable.core = {};\n}\n\nfunction get_named_arguments(params, names) {\n  if (params.length > 1) {\n    var new_params = {};\n\n    for (var i = 0; i < names.length; i++) {\n      new_params[names[i]] = params[i];\n    }\n\n    return new_params;\n  } else if (params.length == 1) {\n    return params[0];\n  } else {\n    return {};\n  }\n}\n\nvar ccv = {\n  pre: function pre(image) {\n    if (image.tagName.toLowerCase() == \"img\") {\n      var canvas = document.createElement(\"canvas\");\n      document.body.appendChild(image);\n      canvas.width = image.offsetWidth;\n      canvas.style.width = image.offsetWidth.toString() + \"px\";\n      canvas.height = image.offsetHeight;\n      canvas.style.height = image.offsetHeight.toString() + \"px\";\n      document.body.removeChild(image);\n      var ctx = canvas.getContext(\"2d\");\n      ctx.drawImage(image, 0, 0);\n      return canvas;\n    }\n\n    return image;\n  },\n  grayscale: function grayscale(canvas) {\n    var ctx = canvas.getContext(\"2d\");\n    var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n    var data = imageData.data;\n    var pix1,\n        pix2,\n        pix = canvas.width * canvas.height * 4;\n\n    while (pix > 0) {\n      data[pix -= 4] = data[pix1 = pix + 1] = data[pix2 = pix + 2] = data[pix] * 0.3 + data[pix1] * 0.59 + data[pix2] * 0.11;\n    }\n\n    ctx.putImageData(imageData, 0, 0);\n    return canvas;\n  },\n  array_group: function array_group(seq, gfunc) {\n    var i, j;\n    var node = new Array(seq.length);\n\n    for (i = 0; i < seq.length; i++) {\n      node[i] = {\n        \"parent\": -1,\n        \"element\": seq[i],\n        \"rank\": 0\n      };\n    }\n\n    for (i = 0; i < seq.length; i++) {\n      if (!node[i].element) continue;\n      var root = i;\n\n      while (node[root].parent != -1) {\n        root = node[root].parent;\n      }\n\n      for (j = 0; j < seq.length; j++) {\n        if (i != j && node[j].element && gfunc(node[i].element, node[j].element)) {\n          var root2 = j;\n\n          while (node[root2].parent != -1) {\n            root2 = node[root2].parent;\n          }\n\n          if (root2 != root) {\n            if (node[root].rank > node[root2].rank) node[root2].parent = root;else {\n              node[root].parent = root2;\n              if (node[root].rank == node[root2].rank) node[root2].rank++;\n              root = root2;\n            }\n            /* compress path from node2 to the root: */\n\n            var temp,\n                node2 = j;\n\n            while (node[node2].parent != -1) {\n              temp = node2;\n              node2 = node[node2].parent;\n              node[temp].parent = root;\n            }\n            /* compress path from node to the root: */\n\n\n            node2 = i;\n\n            while (node[node2].parent != -1) {\n              temp = node2;\n              node2 = node[node2].parent;\n              node[temp].parent = root;\n            }\n          }\n        }\n      }\n    }\n\n    var idx = new Array(seq.length);\n    var class_idx = 0;\n\n    for (i = 0; i < seq.length; i++) {\n      j = -1;\n      var node1 = i;\n\n      if (node[node1].element) {\n        while (node[node1].parent != -1) {\n          node1 = node[node1].parent;\n        }\n\n        if (node[node1].rank >= 0) node[node1].rank = ~class_idx++;\n        j = ~node[node1].rank;\n      }\n\n      idx[i] = j;\n    }\n\n    return {\n      \"index\": idx,\n      \"cat\": class_idx\n    };\n  },\n  detect_objects: parallable(scriptPath, function (canvas, cascade, interval, min_neighbors) {\n    if (this.shared !== undefined) {\n      var params = get_named_arguments(arguments, [\"canvas\", \"cascade\", \"interval\", \"min_neighbors\"]);\n      this.shared.canvas = params.canvas;\n      this.shared.interval = params.interval;\n      this.shared.min_neighbors = params.min_neighbors;\n      this.shared.cascade = params.cascade;\n      this.shared.scale = Math.pow(2, 1 / (params.interval + 1));\n      this.shared.next = params.interval + 1;\n      this.shared.scale_upto = Math.floor(Math.log(Math.min(params.canvas.width / params.cascade.width, params.canvas.height / params.cascade.height)) / Math.log(this.shared.scale));\n      var i;\n\n      for (i = 0; i < this.shared.cascade.stage_classifier.length; i++) {\n        this.shared.cascade.stage_classifier[i].orig_feature = this.shared.cascade.stage_classifier[i].feature;\n      }\n    }\n\n    function pre(worker_num) {\n      var canvas = this.shared.canvas;\n      var interval = this.shared.interval;\n      var scale = this.shared.scale;\n      var next = this.shared.next;\n      var scale_upto = this.shared.scale_upto;\n      var pyr = new Array((scale_upto + next * 2) * 4);\n      var ret = new Array((scale_upto + next * 2) * 4);\n      pyr[0] = canvas;\n      ret[0] = {\n        \"width\": pyr[0].width,\n        \"height\": pyr[0].height,\n        \"data\": pyr[0].getContext(\"2d\").getImageData(0, 0, pyr[0].width, pyr[0].height).data\n      };\n      var i;\n\n      for (i = 1; i <= interval; i++) {\n        pyr[i * 4] = document.createElement(\"canvas\");\n        pyr[i * 4].width = Math.floor(pyr[0].width / Math.pow(scale, i));\n        pyr[i * 4].height = Math.floor(pyr[0].height / Math.pow(scale, i));\n        pyr[i * 4].getContext(\"2d\").drawImage(pyr[0], 0, 0, pyr[0].width, pyr[0].height, 0, 0, pyr[i * 4].width, pyr[i * 4].height);\n        ret[i * 4] = {\n          \"width\": pyr[i * 4].width,\n          \"height\": pyr[i * 4].height,\n          \"data\": pyr[i * 4].getContext(\"2d\").getImageData(0, 0, pyr[i * 4].width, pyr[i * 4].height).data\n        };\n      }\n\n      for (i = next; i < scale_upto + next * 2; i++) {\n        pyr[i * 4] = document.createElement(\"canvas\");\n        pyr[i * 4].width = Math.floor(pyr[i * 4 - next * 4].width / 2);\n        pyr[i * 4].height = Math.floor(pyr[i * 4 - next * 4].height / 2);\n        pyr[i * 4].getContext(\"2d\").drawImage(pyr[i * 4 - next * 4], 0, 0, pyr[i * 4 - next * 4].width, pyr[i * 4 - next * 4].height, 0, 0, pyr[i * 4].width, pyr[i * 4].height);\n        ret[i * 4] = {\n          \"width\": pyr[i * 4].width,\n          \"height\": pyr[i * 4].height,\n          \"data\": pyr[i * 4].getContext(\"2d\").getImageData(0, 0, pyr[i * 4].width, pyr[i * 4].height).data\n        };\n      }\n\n      for (i = next * 2; i < scale_upto + next * 2; i++) {\n        pyr[i * 4 + 1] = document.createElement(\"canvas\");\n        pyr[i * 4 + 1].width = Math.floor(pyr[i * 4 - next * 4].width / 2);\n        pyr[i * 4 + 1].height = Math.floor(pyr[i * 4 - next * 4].height / 2);\n        pyr[i * 4 + 1].getContext(\"2d\").drawImage(pyr[i * 4 - next * 4], 1, 0, pyr[i * 4 - next * 4].width - 1, pyr[i * 4 - next * 4].height, 0, 0, pyr[i * 4 + 1].width - 2, pyr[i * 4 + 1].height);\n        ret[i * 4 + 1] = {\n          \"width\": pyr[i * 4 + 1].width,\n          \"height\": pyr[i * 4 + 1].height,\n          \"data\": pyr[i * 4 + 1].getContext(\"2d\").getImageData(0, 0, pyr[i * 4 + 1].width, pyr[i * 4 + 1].height).data\n        };\n        pyr[i * 4 + 2] = document.createElement(\"canvas\");\n        pyr[i * 4 + 2].width = Math.floor(pyr[i * 4 - next * 4].width / 2);\n        pyr[i * 4 + 2].height = Math.floor(pyr[i * 4 - next * 4].height / 2);\n        pyr[i * 4 + 2].getContext(\"2d\").drawImage(pyr[i * 4 - next * 4], 0, 1, pyr[i * 4 - next * 4].width, pyr[i * 4 - next * 4].height - 1, 0, 0, pyr[i * 4 + 2].width, pyr[i * 4 + 2].height - 2);\n        ret[i * 4 + 2] = {\n          \"width\": pyr[i * 4 + 2].width,\n          \"height\": pyr[i * 4 + 2].height,\n          \"data\": pyr[i * 4 + 2].getContext(\"2d\").getImageData(0, 0, pyr[i * 4 + 2].width, pyr[i * 4 + 2].height).data\n        };\n        pyr[i * 4 + 3] = document.createElement(\"canvas\");\n        pyr[i * 4 + 3].width = Math.floor(pyr[i * 4 - next * 4].width / 2);\n        pyr[i * 4 + 3].height = Math.floor(pyr[i * 4 - next * 4].height / 2);\n        pyr[i * 4 + 3].getContext(\"2d\").drawImage(pyr[i * 4 - next * 4], 1, 1, pyr[i * 4 - next * 4].width - 1, pyr[i * 4 - next * 4].height - 1, 0, 0, pyr[i * 4 + 3].width - 2, pyr[i * 4 + 3].height - 2);\n        ret[i * 4 + 3] = {\n          \"width\": pyr[i * 4 + 3].width,\n          \"height\": pyr[i * 4 + 3].height,\n          \"data\": pyr[i * 4 + 3].getContext(\"2d\").getImageData(0, 0, pyr[i * 4 + 3].width, pyr[i * 4 + 3].height).data\n        };\n      }\n\n      return [ret];\n    }\n\n    ;\n\n    function core(pyr, id, worker_num) {\n      var cascade = this.shared.cascade;\n      var interval = this.shared.interval;\n      var scale = this.shared.scale;\n      var next = this.shared.next;\n      var scale_upto = this.shared.scale_upto;\n      var i, j, k, x, y, q;\n      var scale_x = 1,\n          scale_y = 1;\n      var dx = [0, 1, 0, 1];\n      var dy = [0, 0, 1, 1];\n      var seq = [];\n\n      for (i = 0; i < scale_upto; i++) {\n        var qw = pyr[i * 4 + next * 8].width - Math.floor(cascade.width / 4);\n        var qh = pyr[i * 4 + next * 8].height - Math.floor(cascade.height / 4);\n        var step = [pyr[i * 4].width * 4, pyr[i * 4 + next * 4].width * 4, pyr[i * 4 + next * 8].width * 4];\n        var paddings = [pyr[i * 4].width * 16 - qw * 16, pyr[i * 4 + next * 4].width * 8 - qw * 8, pyr[i * 4 + next * 8].width * 4 - qw * 4];\n\n        for (j = 0; j < cascade.stage_classifier.length; j++) {\n          var orig_feature = cascade.stage_classifier[j].orig_feature;\n          var feature = cascade.stage_classifier[j].feature = new Array(cascade.stage_classifier[j].count);\n\n          for (k = 0; k < cascade.stage_classifier[j].count; k++) {\n            feature[k] = {\n              \"size\": orig_feature[k].size,\n              \"px\": new Array(orig_feature[k].size),\n              \"pz\": new Array(orig_feature[k].size),\n              \"nx\": new Array(orig_feature[k].size),\n              \"nz\": new Array(orig_feature[k].size)\n            };\n\n            for (q = 0; q < orig_feature[k].size; q++) {\n              feature[k].px[q] = orig_feature[k].px[q] * 4 + orig_feature[k].py[q] * step[orig_feature[k].pz[q]];\n              feature[k].pz[q] = orig_feature[k].pz[q];\n              feature[k].nx[q] = orig_feature[k].nx[q] * 4 + orig_feature[k].ny[q] * step[orig_feature[k].nz[q]];\n              feature[k].nz[q] = orig_feature[k].nz[q];\n            }\n          }\n        }\n\n        for (q = 0; q < 4; q++) {\n          var u8 = [pyr[i * 4].data, pyr[i * 4 + next * 4].data, pyr[i * 4 + next * 8 + q].data];\n          var u8o = [dx[q] * 8 + dy[q] * pyr[i * 4].width * 8, dx[q] * 4 + dy[q] * pyr[i * 4 + next * 4].width * 4, 0];\n\n          for (y = 0; y < qh; y++) {\n            for (x = 0; x < qw; x++) {\n              var sum = 0;\n              var flag = true;\n\n              for (j = 0; j < cascade.stage_classifier.length; j++) {\n                sum = 0;\n                var alpha = cascade.stage_classifier[j].alpha;\n                var feature = cascade.stage_classifier[j].feature;\n\n                for (k = 0; k < cascade.stage_classifier[j].count; k++) {\n                  var feature_k = feature[k];\n                  var p,\n                      pmin = u8[feature_k.pz[0]][u8o[feature_k.pz[0]] + feature_k.px[0]];\n                  var n,\n                      nmax = u8[feature_k.nz[0]][u8o[feature_k.nz[0]] + feature_k.nx[0]];\n\n                  if (pmin <= nmax) {\n                    sum += alpha[k * 2];\n                  } else {\n                    var f,\n                        shortcut = true;\n\n                    for (f = 0; f < feature_k.size; f++) {\n                      if (feature_k.pz[f] >= 0) {\n                        p = u8[feature_k.pz[f]][u8o[feature_k.pz[f]] + feature_k.px[f]];\n\n                        if (p < pmin) {\n                          if (p <= nmax) {\n                            shortcut = false;\n                            break;\n                          }\n\n                          pmin = p;\n                        }\n                      }\n\n                      if (feature_k.nz[f] >= 0) {\n                        n = u8[feature_k.nz[f]][u8o[feature_k.nz[f]] + feature_k.nx[f]];\n\n                        if (n > nmax) {\n                          if (pmin <= n) {\n                            shortcut = false;\n                            break;\n                          }\n\n                          nmax = n;\n                        }\n                      }\n                    }\n\n                    sum += shortcut ? alpha[k * 2 + 1] : alpha[k * 2];\n                  }\n                }\n\n                if (sum < cascade.stage_classifier[j].threshold) {\n                  flag = false;\n                  break;\n                }\n              }\n\n              if (flag) {\n                seq.push({\n                  \"x\": (x * 4 + dx[q] * 2) * scale_x,\n                  \"y\": (y * 4 + dy[q] * 2) * scale_y,\n                  \"width\": cascade.width * scale_x,\n                  \"height\": cascade.height * scale_y,\n                  \"neighbor\": 1,\n                  \"confidence\": sum\n                });\n              }\n\n              u8o[0] += 16;\n              u8o[1] += 8;\n              u8o[2] += 4;\n            }\n\n            u8o[0] += paddings[0];\n            u8o[1] += paddings[1];\n            u8o[2] += paddings[2];\n          }\n        }\n\n        scale_x *= scale;\n        scale_y *= scale;\n      }\n\n      return seq;\n    }\n\n    ;\n\n    function post(seq) {\n      var min_neighbors = this.shared.min_neighbors;\n      var cascade = this.shared.cascade;\n      var interval = this.shared.interval;\n      var scale = this.shared.scale;\n      var next = this.shared.next;\n      var scale_upto = this.shared.scale_upto;\n      var i, j;\n\n      for (i = 0; i < cascade.stage_classifier.length; i++) {\n        cascade.stage_classifier[i].feature = cascade.stage_classifier[i].orig_feature;\n      }\n\n      seq = seq[0];\n      if (!(min_neighbors > 0)) return seq;else {\n        var result = ccv.array_group(seq, function (r1, r2) {\n          var distance = Math.floor(r1.width * 0.25 + 0.5);\n          return r2.x <= r1.x + distance && r2.x >= r1.x - distance && r2.y <= r1.y + distance && r2.y >= r1.y - distance && r2.width <= Math.floor(r1.width * 1.5 + 0.5) && Math.floor(r2.width * 1.5 + 0.5) >= r1.width;\n        });\n        var ncomp = result.cat;\n        var idx_seq = result.index;\n        var comps = new Array(ncomp + 1);\n\n        for (i = 0; i < comps.length; i++) {\n          comps[i] = {\n            \"neighbors\": 0,\n            \"x\": 0,\n            \"y\": 0,\n            \"width\": 0,\n            \"height\": 0,\n            \"confidence\": 0\n          };\n        } // count number of neighbors\n\n\n        for (i = 0; i < seq.length; i++) {\n          var r1 = seq[i];\n          var idx = idx_seq[i];\n          if (comps[idx].neighbors == 0) comps[idx].confidence = r1.confidence;\n          ++comps[idx].neighbors;\n          comps[idx].x += r1.x;\n          comps[idx].y += r1.y;\n          comps[idx].width += r1.width;\n          comps[idx].height += r1.height;\n          comps[idx].confidence = Math.max(comps[idx].confidence, r1.confidence);\n        }\n\n        var seq2 = []; // calculate average bounding box\n\n        for (i = 0; i < ncomp; i++) {\n          var n = comps[i].neighbors;\n          if (n >= min_neighbors) seq2.push({\n            \"x\": (comps[i].x * 2 + n) / (2 * n),\n            \"y\": (comps[i].y * 2 + n) / (2 * n),\n            \"width\": (comps[i].width * 2 + n) / (2 * n),\n            \"height\": (comps[i].height * 2 + n) / (2 * n),\n            \"neighbors\": comps[i].neighbors,\n            \"confidence\": comps[i].confidence\n          });\n        }\n\n        var result_seq = []; // filter out small face rectangles inside large face rectangles\n\n        for (i = 0; i < seq2.length; i++) {\n          var r1 = seq2[i];\n          var flag = true;\n\n          for (j = 0; j < seq2.length; j++) {\n            var r2 = seq2[j];\n            var distance = Math.floor(r2.width * 0.25 + 0.5);\n\n            if (i != j && r1.x >= r2.x - distance && r1.y >= r2.y - distance && r1.x + r1.width <= r2.x + r2.width + distance && r1.y + r1.height <= r2.y + r2.height + distance && (r2.neighbors > Math.max(3, r1.neighbors) || r1.neighbors < 3)) {\n              flag = false;\n              break;\n            }\n          }\n\n          if (flag) result_seq.push(r1);\n        }\n\n        return result_seq;\n      }\n    }\n\n    ;\n    return {\n      \"pre\": pre,\n      \"core\": core,\n      \"post\": post\n    };\n  })\n}; // Monkey patch to avoid overriding window's onmessage handler.\n\nvar originalOnMessage = window.onmessage || function () {};\n\nonmessage = function onmessage(event) {\n  var data;\n\n  try {\n    data = typeof event.data == \"string\" ? JSON.parse(event.data) : event.data;\n\n    if (data.type === \"jquery.facedetection\") {\n      // This is the event that is intended for jquery.facedetection\n      var scope = {\n        \"shared\": data.shared\n      };\n      var result = parallable.core[data.name].apply(scope, [data.input, data.id, data.worker]);\n\n      try {\n        postMessage(result);\n      } catch (e) {\n        postMessage(JSON.stringify(result));\n      }\n    } else {\n      // Nope. This is not the event that should be handled by jquery.facedetection\n      var args = Array.prototype.slice.call(arguments);\n      originalOnMessage.apply(window, args);\n    }\n  } catch (e) {\n    // `event.data` is string, but too bad it is not in JSON format.\n    // so just pass it to window's original onmessage handler\n    var args = Array.prototype.slice.call(arguments);\n    originalOnMessage.apply(window, args);\n  }\n};","map":{"version":3,"sources":["/home/lihn/rollcall/app/javascript/packs/ccv.js"],"names":["getScriptPath","scripts","document","getElementsByTagName","i","length","src","match","scriptPath","e","parallable","undefined","file","funct","core","toString","async","worker_num","params","arguments","Array","worker","scope","ctrl","apply","complete","error","executed","outputs","inputs","pre","shared","tagName","Worker","onmessage","event","data","JSON","parse","post","msg","postMessage","stringify","get_named_arguments","names","new_params","ccv","image","toLowerCase","canvas","createElement","body","appendChild","width","offsetWidth","style","height","offsetHeight","removeChild","ctx","getContext","drawImage","grayscale","imageData","getImageData","pix1","pix2","pix","putImageData","array_group","seq","gfunc","j","node","element","root","parent","root2","rank","temp","node2","idx","class_idx","node1","detect_objects","cascade","interval","min_neighbors","scale","Math","pow","next","scale_upto","floor","log","min","stage_classifier","orig_feature","feature","pyr","ret","id","k","x","y","q","scale_x","scale_y","dx","dy","qw","qh","step","paddings","count","size","px","py","pz","nx","ny","nz","u8","u8o","sum","flag","alpha","feature_k","p","pmin","n","nmax","f","shortcut","threshold","push","result","r1","r2","distance","ncomp","cat","idx_seq","index","comps","neighbors","confidence","max","seq2","result_seq","originalOnMessage","window","type","name","input","args","prototype","slice","call"],"mappings":"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","sourcesContent":["/*\nCopyright (c) 2010, Liu Liu\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:\n\n* Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.\n* Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.\n* Neither the name of the authors nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.\n*/\n\n/* Added by Jay Salvat: Get Script Path */\ntry {\n    var getScriptPath = function () {\n    \t\"use strict\";\n\n        var scripts = document.getElementsByTagName('script');\n\n        for (var i = 0; i < scripts.length; i++) {\n            if (scripts[i].src.match(/(jquery\\.facedetection(\\.min)?\\.js)|\\/ccv\\.js/)) {\n                return scripts[i].src;\n            }\n        }\n    };\n\n    var scriptPath = getScriptPath();\n} catch (e) {}\n/* End Jay Salvat */\n\nif (parallable === undefined) {\n\tvar parallable = function (file, funct) {\n\t\t\"use strict\";\n\n\t\tparallable.core[funct.toString()] = funct().core;\n\n\t\treturn function () {\n\t\t\tvar i;\n\t\t\tvar async, worker_num, params;\n\t\t\tif (arguments.length > 1) {\n\t\t\t\tasync = arguments[arguments.length - 2];\n\t\t\t\tworker_num = arguments[arguments.length - 1];\n\t\t\t\tparams = new Array(arguments.length - 2);\n\t\t\t\tfor (i = 0; i < arguments.length - 2; i++)\n\t\t\t\t\tparams[i] = arguments[i];\n\t\t\t} else {\n\t\t\t\tasync = arguments[0].async;\n\t\t\t\tworker_num = arguments[0].worker;\n\t\t\t\tparams = arguments[0];\n\t\t\t\tdelete params[\"async\"];\n\t\t\t\tdelete params[\"worker\"];\n\t\t\t\tparams = [params];\n\t\t\t}\n\t\t\tvar scope = { \"shared\" : {} };\n\t\t\tvar ctrl = funct.apply(scope, params);\n\t\t\tif (async) {\n\t\t\t\treturn function (complete, error) {\n\t\t\t\t\tvar executed = 0;\n\t\t\t\t\tvar outputs = new Array(worker_num);\n\t\t\t\t\tvar inputs = ctrl.pre.apply(scope, [worker_num]);\n\t\t\t\t\t/* sanitize scope shared because for Chrome/WebKit, worker only support JSONable data */\n\t\t\t\t\tfor (i in scope.shared)\n\t\t\t\t\t\t/* delete function, if any */\n\t\t\t\t\t\tif (typeof scope.shared[i] == \"function\")\n\t\t\t\t\t\t\tdelete scope.shared[i];\n\t\t\t\t\t\t/* delete DOM object, if any */\n\t\t\t\t\t\telse if (scope.shared[i].tagName !== undefined)\n\t\t\t\t\t\t\tdelete scope.shared[i];\n\t\t\t\t\tfor (i = 0; i < worker_num; i++) {\n\t\t\t\t\t\tvar worker = new Worker(file);\n\t\t\t\t\t\tworker.onmessage = (function (i) {\n\t\t\t\t\t\t\treturn function (event) {\n\t\t\t\t\t\t\t\toutputs[i] = (typeof event.data == \"string\") ? JSON.parse(event.data) : event.data;\n\t\t\t\t\t\t\t\texecuted++;\n\t\t\t\t\t\t\t\tif (executed == worker_num)\n\t\t\t\t\t\t\t\t\tcomplete(ctrl.post.apply(scope, [outputs]));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})(i);\n\t\t\t\t\t\tvar msg = { \"input\" : inputs[i],\n\t\t\t\t\t\t\t\t\t\"name\" : funct.toString(),\n\t\t\t\t\t\t\t\t\t\"shared\" : scope.shared,\n\t\t\t\t\t\t\t\t\t\"id\" : i,\n\t\t\t\t\t\t\t\t\t\"worker\" : params.worker_num,\n                  \"from\" : \"jquery.facedetection\" };\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tworker.postMessage(msg);\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tworker.postMessage(JSON.stringify(msg));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn ctrl.post.apply(scope, [[ctrl.core.apply(scope, [ctrl.pre.apply(scope, [1])[0], 0, 1])]]);\n\t\t\t}\n\t\t}\n\t};\n\tparallable.core = {};\n}\n\nfunction get_named_arguments(params, names) {\n\tif (params.length > 1) {\n\t\tvar new_params = {};\n\t\tfor (var i = 0; i < names.length; i++)\n\t\t\tnew_params[names[i]] = params[i];\n\t\treturn new_params;\n\t} else if (params.length == 1) {\n\t\treturn params[0];\n\t} else {\n\t\treturn {};\n\t}\n}\n\nvar ccv = {\n\tpre : function (image) {\n\t\tif (image.tagName.toLowerCase() == \"img\") {\n\t\t\tvar canvas = document.createElement(\"canvas\");\n\t\t\tdocument.body.appendChild(image);\n\t\t\tcanvas.width = image.offsetWidth;\n\t\t\tcanvas.style.width = image.offsetWidth.toString() + \"px\";\n\t\t\tcanvas.height = image.offsetHeight;\n\t\t\tcanvas.style.height = image.offsetHeight.toString() + \"px\";\n\t\t\tdocument.body.removeChild(image);\n\t\t\tvar ctx = canvas.getContext(\"2d\");\n\t\t\tctx.drawImage(image, 0, 0);\n\t\t\treturn canvas;\n\t\t}\n\t\treturn image;\n\t},\n\n\tgrayscale : function (canvas) {\n\t\tvar ctx = canvas.getContext(\"2d\");\n\t\tvar imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n\t\tvar data = imageData.data;\n\t\tvar pix1, pix2, pix = canvas.width * canvas.height * 4;\n\t\twhile (pix > 0)\n\t\t\tdata[pix -= 4] = data[pix1 = pix + 1] = data[pix2 = pix + 2] = (data[pix] * 0.3 + data[pix1] * 0.59 + data[pix2] * 0.11);\n\t\tctx.putImageData(imageData, 0, 0);\n\t\treturn canvas;\n\t},\n\n\tarray_group : function (seq, gfunc) {\n\t\tvar i, j;\n\t\tvar node = new Array(seq.length);\n\t\tfor (i = 0; i < seq.length; i++)\n\t\t\tnode[i] = {\"parent\" : -1,\n\t\t\t\t\t   \"element\" : seq[i],\n\t\t\t\t\t   \"rank\" : 0};\n\t\tfor (i = 0; i < seq.length; i++) {\n\t\t\tif (!node[i].element)\n\t\t\t\tcontinue;\n\t\t\tvar root = i;\n\t\t\twhile (node[root].parent != -1)\n\t\t\t\troot = node[root].parent;\n\t\t\tfor (j = 0; j < seq.length; j++) {\n\t\t\t\tif( i != j && node[j].element && gfunc(node[i].element, node[j].element)) {\n\t\t\t\t\tvar root2 = j;\n\n\t\t\t\t\twhile (node[root2].parent != -1)\n\t\t\t\t\t\troot2 = node[root2].parent;\n\n\t\t\t\t\tif(root2 != root) {\n\t\t\t\t\t\tif(node[root].rank > node[root2].rank)\n\t\t\t\t\t\t\tnode[root2].parent = root;\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tnode[root].parent = root2;\n\t\t\t\t\t\t\tif (node[root].rank == node[root2].rank)\n\t\t\t\t\t\t\tnode[root2].rank++;\n\t\t\t\t\t\t\troot = root2;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* compress path from node2 to the root: */\n\t\t\t\t\t\tvar temp, node2 = j;\n\t\t\t\t\t\twhile (node[node2].parent != -1) {\n\t\t\t\t\t\t\ttemp = node2;\n\t\t\t\t\t\t\tnode2 = node[node2].parent;\n\t\t\t\t\t\t\tnode[temp].parent = root;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* compress path from node to the root: */\n\t\t\t\t\t\tnode2 = i;\n\t\t\t\t\t\twhile (node[node2].parent != -1) {\n\t\t\t\t\t\t\ttemp = node2;\n\t\t\t\t\t\t\tnode2 = node[node2].parent;\n\t\t\t\t\t\t\tnode[temp].parent = root;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tvar idx = new Array(seq.length);\n\t\tvar class_idx = 0;\n\t\tfor(i = 0; i < seq.length; i++) {\n\t\t\tj = -1;\n\t\t\tvar node1 = i;\n\t\t\tif(node[node1].element) {\n\t\t\t\twhile (node[node1].parent != -1)\n\t\t\t\t\tnode1 = node[node1].parent;\n\t\t\t\tif(node[node1].rank >= 0)\n\t\t\t\t\tnode[node1].rank = ~class_idx++;\n\t\t\t\tj = ~node[node1].rank;\n\t\t\t}\n\t\t\tidx[i] = j;\n\t\t}\n\t\treturn {\"index\" : idx, \"cat\" : class_idx};\n\t},\n\n\tdetect_objects : parallable(scriptPath, function (canvas, cascade, interval, min_neighbors) {\n\t\tif (this.shared !== undefined) {\n\t\t\tvar params = get_named_arguments(arguments, [\"canvas\", \"cascade\", \"interval\", \"min_neighbors\"]);\n\t\t\tthis.shared.canvas = params.canvas;\n\t\t\tthis.shared.interval = params.interval;\n\t\t\tthis.shared.min_neighbors = params.min_neighbors;\n\t\t\tthis.shared.cascade = params.cascade;\n\t\t\tthis.shared.scale = Math.pow(2, 1 / (params.interval + 1));\n\t\t\tthis.shared.next = params.interval + 1;\n\t\t\tthis.shared.scale_upto = Math.floor(Math.log(Math.min(params.canvas.width / params.cascade.width, params.canvas.height / params.cascade.height)) / Math.log(this.shared.scale));\n\t\t\tvar i;\n\t\t\tfor (i = 0; i < this.shared.cascade.stage_classifier.length; i++)\n\t\t\t\tthis.shared.cascade.stage_classifier[i].orig_feature = this.shared.cascade.stage_classifier[i].feature;\n\t\t}\n\n\t\tfunction pre(worker_num) {\n\t\t\tvar canvas = this.shared.canvas;\n\t\t\tvar interval = this.shared.interval;\n\t\t\tvar scale = this.shared.scale;\n\t\t\tvar next = this.shared.next;\n\t\t\tvar scale_upto = this.shared.scale_upto;\n\t\t\tvar pyr = new Array((scale_upto + next * 2) * 4);\n\t\t\tvar ret = new Array((scale_upto + next * 2) * 4);\n\t\t\tpyr[0] = canvas;\n\t\t\tret[0] = { \"width\" : pyr[0].width,\n\t\t\t\t\t   \"height\" : pyr[0].height,\n\t\t\t\t\t   \"data\" : pyr[0].getContext(\"2d\").getImageData(0, 0, pyr[0].width, pyr[0].height).data };\n\t\t\tvar i;\n\t\t\tfor (i = 1; i <= interval; i++) {\n\t\t\t\tpyr[i * 4] = document.createElement(\"canvas\");\n\t\t\t\tpyr[i * 4].width = Math.floor(pyr[0].width / Math.pow(scale, i));\n\t\t\t\tpyr[i * 4].height = Math.floor(pyr[0].height / Math.pow(scale, i));\n\t\t\t\tpyr[i * 4].getContext(\"2d\").drawImage(pyr[0], 0, 0, pyr[0].width, pyr[0].height, 0, 0, pyr[i * 4].width, pyr[i * 4].height);\n\t\t\t\tret[i * 4] = { \"width\" : pyr[i * 4].width,\n\t\t\t\t\t\t\t   \"height\" : pyr[i * 4].height,\n\t\t\t\t\t\t\t   \"data\" : pyr[i * 4].getContext(\"2d\").getImageData(0, 0, pyr[i * 4].width, pyr[i * 4].height).data };\n\t\t\t}\n\t\t\tfor (i = next; i < scale_upto + next * 2; i++) {\n\t\t\t\tpyr[i * 4] = document.createElement(\"canvas\");\n\t\t\t\tpyr[i * 4].width = Math.floor(pyr[i * 4 - next * 4].width / 2);\n\t\t\t\tpyr[i * 4].height = Math.floor(pyr[i * 4 - next * 4].height / 2);\n\t\t\t\tpyr[i * 4].getContext(\"2d\").drawImage(pyr[i * 4 - next * 4], 0, 0, pyr[i * 4 - next * 4].width, pyr[i * 4 - next * 4].height, 0, 0, pyr[i * 4].width, pyr[i * 4].height);\n\t\t\t\tret[i * 4] = { \"width\" : pyr[i * 4].width,\n\t\t\t\t\t\t\t   \"height\" : pyr[i * 4].height,\n\t\t\t\t\t\t\t   \"data\" : pyr[i * 4].getContext(\"2d\").getImageData(0, 0, pyr[i * 4].width, pyr[i * 4].height).data };\n\t\t\t}\n\t\t\tfor (i = next * 2; i < scale_upto + next * 2; i++) {\n\t\t\t\tpyr[i * 4 + 1] = document.createElement(\"canvas\");\n\t\t\t\tpyr[i * 4 + 1].width = Math.floor(pyr[i * 4 - next * 4].width / 2);\n\t\t\t\tpyr[i * 4 + 1].height = Math.floor(pyr[i * 4 - next * 4].height / 2);\n\t\t\t\tpyr[i * 4 + 1].getContext(\"2d\").drawImage(pyr[i * 4 - next * 4], 1, 0, pyr[i * 4 - next * 4].width - 1, pyr[i * 4 - next * 4].height, 0, 0, pyr[i * 4 + 1].width - 2, pyr[i * 4 + 1].height);\n\t\t\t\tret[i * 4 + 1] = { \"width\" : pyr[i * 4 + 1].width,\n\t\t\t\t\t\t\t\t   \"height\" : pyr[i * 4 + 1].height,\n\t\t\t\t\t\t\t\t   \"data\" : pyr[i * 4 + 1].getContext(\"2d\").getImageData(0, 0, pyr[i * 4 + 1].width, pyr[i * 4 + 1].height).data };\n\t\t\t\tpyr[i * 4 + 2] = document.createElement(\"canvas\");\n\t\t\t\tpyr[i * 4 + 2].width = Math.floor(pyr[i * 4 - next * 4].width / 2);\n\t\t\t\tpyr[i * 4 + 2].height = Math.floor(pyr[i * 4 - next * 4].height / 2);\n\t\t\t\tpyr[i * 4 + 2].getContext(\"2d\").drawImage(pyr[i * 4 - next * 4], 0, 1, pyr[i * 4 - next * 4].width, pyr[i * 4 - next * 4].height - 1, 0, 0, pyr[i * 4 + 2].width, pyr[i * 4 + 2].height - 2);\n\t\t\t\tret[i * 4 + 2] = { \"width\" : pyr[i * 4 + 2].width,\n\t\t\t\t\t\t\t\t   \"height\" : pyr[i * 4 + 2].height,\n\t\t\t\t\t\t\t\t   \"data\" : pyr[i * 4 + 2].getContext(\"2d\").getImageData(0, 0, pyr[i * 4 + 2].width, pyr[i * 4 + 2].height).data };\n\t\t\t\tpyr[i * 4 + 3] = document.createElement(\"canvas\");\n\t\t\t\tpyr[i * 4 + 3].width = Math.floor(pyr[i * 4 - next * 4].width / 2);\n\t\t\t\tpyr[i * 4 + 3].height = Math.floor(pyr[i * 4 - next * 4].height / 2);\n\t\t\t\tpyr[i * 4 + 3].getContext(\"2d\").drawImage(pyr[i * 4 - next * 4], 1, 1, pyr[i * 4 - next * 4].width - 1, pyr[i * 4 - next * 4].height - 1, 0, 0, pyr[i * 4 + 3].width - 2, pyr[i * 4 + 3].height - 2);\n\t\t\t\tret[i * 4 + 3] = { \"width\" : pyr[i * 4 + 3].width,\n\t\t\t\t\t\t\t\t   \"height\" : pyr[i * 4 + 3].height,\n\t\t\t\t\t\t\t\t   \"data\" : pyr[i * 4 + 3].getContext(\"2d\").getImageData(0, 0, pyr[i * 4 + 3].width, pyr[i * 4 + 3].height).data };\n\t\t\t}\n\t\t\treturn [ret];\n\t\t};\n\n\t\tfunction core(pyr, id, worker_num) {\n\t\t\tvar cascade = this.shared.cascade;\n\t\t\tvar interval = this.shared.interval;\n\t\t\tvar scale = this.shared.scale;\n\t\t\tvar next = this.shared.next;\n\t\t\tvar scale_upto = this.shared.scale_upto;\n\t\t\tvar i, j, k, x, y, q;\n\t\t\tvar scale_x = 1, scale_y = 1;\n\t\t\tvar dx = [0, 1, 0, 1];\n\t\t\tvar dy = [0, 0, 1, 1];\n\t\t\tvar seq = [];\n\t\t\tfor (i = 0; i < scale_upto; i++) {\n\t\t\t\tvar qw = pyr[i * 4 + next * 8].width - Math.floor(cascade.width / 4);\n\t\t\t\tvar qh = pyr[i * 4 + next * 8].height - Math.floor(cascade.height / 4);\n\t\t\t\tvar step = [pyr[i * 4].width * 4, pyr[i * 4 + next * 4].width * 4, pyr[i * 4 + next * 8].width * 4];\n\t\t\t\tvar paddings = [pyr[i * 4].width * 16 - qw * 16,\n\t\t\t\t\t\t\t\tpyr[i * 4 + next * 4].width * 8 - qw * 8,\n\t\t\t\t\t\t\t\tpyr[i * 4 + next * 8].width * 4 - qw * 4];\n\t\t\t\tfor (j = 0; j < cascade.stage_classifier.length; j++) {\n\t\t\t\t\tvar orig_feature = cascade.stage_classifier[j].orig_feature;\n\t\t\t\t\tvar feature = cascade.stage_classifier[j].feature = new Array(cascade.stage_classifier[j].count);\n\t\t\t\t\tfor (k = 0; k < cascade.stage_classifier[j].count; k++) {\n\t\t\t\t\t\tfeature[k] = {\"size\" : orig_feature[k].size,\n\t\t\t\t\t\t\t\t\t  \"px\" : new Array(orig_feature[k].size),\n\t\t\t\t\t\t\t\t\t  \"pz\" : new Array(orig_feature[k].size),\n\t\t\t\t\t\t\t\t\t  \"nx\" : new Array(orig_feature[k].size),\n\t\t\t\t\t\t\t\t\t  \"nz\" : new Array(orig_feature[k].size)};\n\t\t\t\t\t\tfor (q = 0; q < orig_feature[k].size; q++) {\n\t\t\t\t\t\t\tfeature[k].px[q] = orig_feature[k].px[q] * 4 + orig_feature[k].py[q] * step[orig_feature[k].pz[q]];\n\t\t\t\t\t\t\tfeature[k].pz[q] = orig_feature[k].pz[q];\n\t\t\t\t\t\t\tfeature[k].nx[q] = orig_feature[k].nx[q] * 4 + orig_feature[k].ny[q] * step[orig_feature[k].nz[q]];\n\t\t\t\t\t\t\tfeature[k].nz[q] = orig_feature[k].nz[q];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (q = 0; q < 4; q++) {\n\t\t\t\t\tvar u8 = [pyr[i * 4].data, pyr[i * 4 + next * 4].data, pyr[i * 4 + next * 8 + q].data];\n\t\t\t\t\tvar u8o = [dx[q] * 8 + dy[q] * pyr[i * 4].width * 8, dx[q] * 4 + dy[q] * pyr[i * 4 + next * 4].width * 4, 0];\n\t\t\t\t\tfor (y = 0; y < qh; y++) {\n\t\t\t\t\t\tfor (x = 0; x < qw; x++) {\n\t\t\t\t\t\t\tvar sum = 0;\n\t\t\t\t\t\t\tvar flag = true;\n\t\t\t\t\t\t\tfor (j = 0; j < cascade.stage_classifier.length; j++) {\n\t\t\t\t\t\t\t\tsum = 0;\n\t\t\t\t\t\t\t\tvar alpha = cascade.stage_classifier[j].alpha;\n\t\t\t\t\t\t\t\tvar feature = cascade.stage_classifier[j].feature;\n\t\t\t\t\t\t\t\tfor (k = 0; k < cascade.stage_classifier[j].count; k++) {\n\t\t\t\t\t\t\t\t\tvar feature_k = feature[k];\n\t\t\t\t\t\t\t\t\tvar p, pmin = u8[feature_k.pz[0]][u8o[feature_k.pz[0]] + feature_k.px[0]];\n\t\t\t\t\t\t\t\t\tvar n, nmax = u8[feature_k.nz[0]][u8o[feature_k.nz[0]] + feature_k.nx[0]];\n\t\t\t\t\t\t\t\t\tif (pmin <= nmax) {\n\t\t\t\t\t\t\t\t\t\tsum += alpha[k * 2];\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tvar f, shortcut = true;\n\t\t\t\t\t\t\t\t\t\tfor (f = 0; f < feature_k.size; f++) {\n\t\t\t\t\t\t\t\t\t\t\tif (feature_k.pz[f] >= 0) {\n\t\t\t\t\t\t\t\t\t\t\t\tp = u8[feature_k.pz[f]][u8o[feature_k.pz[f]] + feature_k.px[f]];\n\t\t\t\t\t\t\t\t\t\t\t\tif (p < pmin) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (p <= nmax) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tshortcut = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\tpmin = p;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tif (feature_k.nz[f] >= 0) {\n\t\t\t\t\t\t\t\t\t\t\t\tn = u8[feature_k.nz[f]][u8o[feature_k.nz[f]] + feature_k.nx[f]];\n\t\t\t\t\t\t\t\t\t\t\t\tif (n > nmax) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (pmin <= n) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tshortcut = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\tnmax = n;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tsum += (shortcut) ? alpha[k * 2 + 1] : alpha[k * 2];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (sum < cascade.stage_classifier[j].threshold) {\n\t\t\t\t\t\t\t\t\tflag = false;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (flag) {\n\t\t\t\t\t\t\t\tseq.push({\"x\" : (x * 4 + dx[q] * 2) * scale_x,\n\t\t\t\t\t\t\t\t\t\t  \"y\" : (y * 4 + dy[q] * 2) * scale_y,\n\t\t\t\t\t\t\t\t\t\t  \"width\" : cascade.width * scale_x,\n\t\t\t\t\t\t\t\t\t\t  \"height\" : cascade.height * scale_y,\n\t\t\t\t\t\t\t\t\t\t  \"neighbor\" : 1,\n\t\t\t\t\t\t\t\t\t\t  \"confidence\" : sum});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tu8o[0] += 16;\n\t\t\t\t\t\t\tu8o[1] += 8;\n\t\t\t\t\t\t\tu8o[2] += 4;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tu8o[0] += paddings[0];\n\t\t\t\t\t\tu8o[1] += paddings[1];\n\t\t\t\t\t\tu8o[2] += paddings[2];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tscale_x *= scale;\n\t\t\t\tscale_y *= scale;\n\t\t\t}\n\t\t\treturn seq;\n\t\t};\n\n\t\tfunction post(seq) {\n\t\t\tvar min_neighbors = this.shared.min_neighbors;\n\t\t\tvar cascade = this.shared.cascade;\n\t\t\tvar interval = this.shared.interval;\n\t\t\tvar scale = this.shared.scale;\n\t\t\tvar next = this.shared.next;\n\t\t\tvar scale_upto = this.shared.scale_upto;\n\t\t\tvar i, j;\n\t\t\tfor (i = 0; i < cascade.stage_classifier.length; i++)\n\t\t\t\tcascade.stage_classifier[i].feature = cascade.stage_classifier[i].orig_feature;\n\t\t\tseq = seq[0];\n\t\t\tif (!(min_neighbors > 0))\n\t\t\t\treturn seq;\n\t\t\telse {\n\t\t\t\tvar result = ccv.array_group(seq, function (r1, r2) {\n\t\t\t\t\tvar distance = Math.floor(r1.width * 0.25 + 0.5);\n\n\t\t\t\t\treturn r2.x <= r1.x + distance &&\n\t\t\t\t\t\t   r2.x >= r1.x - distance &&\n\t\t\t\t\t\t   r2.y <= r1.y + distance &&\n\t\t\t\t\t\t   r2.y >= r1.y - distance &&\n\t\t\t\t\t\t   r2.width <= Math.floor(r1.width * 1.5 + 0.5) &&\n\t\t\t\t\t\t   Math.floor(r2.width * 1.5 + 0.5) >= r1.width;\n\t\t\t\t});\n\t\t\t\tvar ncomp = result.cat;\n\t\t\t\tvar idx_seq = result.index;\n\t\t\t\tvar comps = new Array(ncomp + 1);\n\t\t\t\tfor (i = 0; i < comps.length; i++)\n\t\t\t\t\tcomps[i] = {\"neighbors\" : 0,\n\t\t\t\t\t\t\t\t\"x\" : 0,\n\t\t\t\t\t\t\t\t\"y\" : 0,\n\t\t\t\t\t\t\t\t\"width\" : 0,\n\t\t\t\t\t\t\t\t\"height\" : 0,\n\t\t\t\t\t\t\t\t\"confidence\" : 0};\n\n\t\t\t\t// count number of neighbors\n\t\t\t\tfor(i = 0; i < seq.length; i++)\n\t\t\t\t{\n\t\t\t\t\tvar r1 = seq[i];\n\t\t\t\t\tvar idx = idx_seq[i];\n\n\t\t\t\t\tif (comps[idx].neighbors == 0)\n\t\t\t\t\t\tcomps[idx].confidence = r1.confidence;\n\n\t\t\t\t\t++comps[idx].neighbors;\n\n\t\t\t\t\tcomps[idx].x += r1.x;\n\t\t\t\t\tcomps[idx].y += r1.y;\n\t\t\t\t\tcomps[idx].width += r1.width;\n\t\t\t\t\tcomps[idx].height += r1.height;\n\t\t\t\t\tcomps[idx].confidence = Math.max(comps[idx].confidence, r1.confidence);\n\t\t\t\t}\n\n\t\t\t\tvar seq2 = [];\n\t\t\t\t// calculate average bounding box\n\t\t\t\tfor(i = 0; i < ncomp; i++)\n\t\t\t\t{\n\t\t\t\t\tvar n = comps[i].neighbors;\n\t\t\t\t\tif (n >= min_neighbors)\n\t\t\t\t\t\tseq2.push({\"x\" : (comps[i].x * 2 + n) / (2 * n),\n\t\t\t\t\t\t\t\t   \"y\" : (comps[i].y * 2 + n) / (2 * n),\n\t\t\t\t\t\t\t\t   \"width\" : (comps[i].width * 2 + n) / (2 * n),\n\t\t\t\t\t\t\t\t   \"height\" : (comps[i].height * 2 + n) / (2 * n),\n\t\t\t\t\t\t\t\t   \"neighbors\" : comps[i].neighbors,\n\t\t\t\t\t\t\t\t   \"confidence\" : comps[i].confidence});\n\t\t\t\t}\n\n\t\t\t\tvar result_seq = [];\n\t\t\t\t// filter out small face rectangles inside large face rectangles\n\t\t\t\tfor(i = 0; i < seq2.length; i++)\n\t\t\t\t{\n\t\t\t\t\tvar r1 = seq2[i];\n\t\t\t\t\tvar flag = true;\n\t\t\t\t\tfor(j = 0; j < seq2.length; j++)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar r2 = seq2[j];\n\t\t\t\t\t\tvar distance = Math.floor(r2.width * 0.25 + 0.5);\n\n\t\t\t\t\t\tif(i != j &&\n\t\t\t\t\t\t   r1.x >= r2.x - distance &&\n\t\t\t\t\t\t   r1.y >= r2.y - distance &&\n\t\t\t\t\t\t   r1.x + r1.width <= r2.x + r2.width + distance &&\n\t\t\t\t\t\t   r1.y + r1.height <= r2.y + r2.height + distance &&\n\t\t\t\t\t\t   (r2.neighbors > Math.max(3, r1.neighbors) || r1.neighbors < 3))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tflag = false;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif(flag)\n\t\t\t\t\t\tresult_seq.push(r1);\n\t\t\t\t}\n\t\t\t\treturn result_seq;\n\t\t\t}\n\t\t};\n\t\treturn { \"pre\" : pre, \"core\" : core, \"post\" : post };\n\t})\n}\n\n// Monkey patch to avoid overriding window's onmessage handler.\nvar originalOnMessage = window.onmessage || function () {};\nonmessage = function (event) {\n  var data;\n  try {\n    data = (typeof event.data == \"string\") ? JSON.parse(event.data) : event.data;\n    if (data.type === \"jquery.facedetection\") {\n      // This is the event that is intended for jquery.facedetection\n      var scope = { \"shared\" : data.shared };\n      var result = parallable.core[data.name].apply(scope, [data.input, data.id, data.worker]);\n      try {\n        postMessage(result);\n      } catch (e) {\n        postMessage(JSON.stringify(result));\n      }\n    } else {\n      // Nope. This is not the event that should be handled by jquery.facedetection\n      var args = Array.prototype.slice.call(arguments);\n      originalOnMessage.apply(window, args);\n    }\n  } catch (e) {\n    // `event.data` is string, but too bad it is not in JSON format.\n    // so just pass it to window's original onmessage handler\n    var args = Array.prototype.slice.call(arguments);\n    originalOnMessage.apply(window, args);\n  }\n}\n"]},"metadata":{},"sourceType":"module"}