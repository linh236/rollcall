{"ast":null,"code":"/*\nFaceDetection jQuery Plugin\nCopyright (c) 2016 Jay Salvat\n*/\n\n/* global $, ccv, cascade */\n$.fn.faceDetection = function (settingsOrCallback) {\n  \"use strict\";\n\n  var time;\n  var options = {\n    interval: 4,\n    minNeighbors: 1,\n    grayscale: true,\n    confidence: null,\n    async: false,\n    complete: function complete() {},\n    // (faces)\n    error: function error() {} // (code, message)\n\n  };\n\n  if ($.isFunction(settingsOrCallback)) {\n    options.complete = settingsOrCallback;\n  } else {\n    $.extend(options, settingsOrCallback);\n  }\n\n  return this.each(function () {\n    var $$ = $(this),\n        offset = $$.offset(),\n        position = $$.position(),\n        scaleX = $$.width() / (this.naturalWidth || this.videoWidth) || 1,\n        scaleY = $$.height() / (this.naturalHeight || this.videoHeight) || 1;\n\n    if (!$$.is('img, video, canvas')) {\n      options.error.apply($$, [1, 'Face detection is possible on images, videos and canvas only.']);\n      options.complete.apply($$, [[]]);\n      return;\n    }\n\n    function detect() {\n      var source, canvas;\n      time = new Date().getTime();\n\n      if ($$.is('img')) {\n        source = new Image();\n        source.src = $$.attr('src');\n        source.crossOrigin = $$.attr('crossorigin');\n        canvas = ccv.pre(source);\n      } else if ($$.is('video') || $$.is('canvas')) {\n        var copy, context;\n        source = $$[0];\n        copy = document.createElement('canvas');\n        copy.setAttribute('width', source.videoWidth || source.width);\n        copy.setAttribute('height', source.videoHeight || source.height);\n        context = copy.getContext(\"2d\");\n        context.drawImage(source, 0, 0);\n        canvas = ccv.pre(copy);\n      }\n\n      if (options.grayscale) {\n        canvas = ccv.grayscale(canvas);\n      }\n\n      try {\n        if (options.async && window.Worker) {\n          ccv.detect_objects({\n            \"canvas\": canvas,\n            \"cascade\": cascade,\n            \"interval\": options.interval,\n            \"min_neighbors\": options.minNeighbors,\n            \"worker\": 1,\n            \"async\": true\n          })(done);\n        } else {\n          done(ccv.detect_objects({\n            \"canvas\": canvas,\n            \"cascade\": cascade,\n            \"interval\": options.interval,\n            \"min_neighbors\": options.minNeighbors\n          }));\n        }\n      } catch (e) {\n        options.error.apply($$, [2, e.message]);\n        options.complete.apply($$, [false]);\n      }\n    }\n\n    function done(faces) {\n      var n = faces.length,\n          data = [];\n\n      for (var i = 0; i < n; ++i) {\n        if (options.confidence !== null && faces[i].confidence <= options.confidence) {\n          continue;\n        }\n\n        faces[i].positionX = position.left + faces[i].x;\n        faces[i].positionY = position.top + faces[i].y;\n        faces[i].offsetX = offset.left + faces[i].x;\n        faces[i].offsetY = offset.top + faces[i].y;\n        faces[i].scaleX = scaleX;\n        faces[i].scaleY = scaleY;\n        data.push(faces[i]);\n      }\n\n      data.time = new Date().getTime() - time;\n      options.complete.apply($$, [data]);\n    }\n\n    return detect();\n  });\n};","map":{"version":3,"sources":["/home/lihn/rollcall/app/javascript/packs/jquery.facedetection.js"],"names":["$","fn","faceDetection","settingsOrCallback","time","options","interval","minNeighbors","grayscale","confidence","async","complete","error","isFunction","extend","each","$$","offset","position","scaleX","width","naturalWidth","videoWidth","scaleY","height","naturalHeight","videoHeight","is","apply","detect","source","canvas","Date","getTime","Image","src","attr","crossOrigin","ccv","pre","copy","context","document","createElement","setAttribute","getContext","drawImage","window","Worker","detect_objects","cascade","done","e","message","faces","n","length","data","i","positionX","left","x","positionY","top","y","offsetX","offsetY","push"],"mappings":"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","sourcesContent":["/*\nFaceDetection jQuery Plugin\nCopyright (c) 2016 Jay Salvat\n*/\n\n/* global $, ccv, cascade */\n\n$.fn.faceDetection = function (settingsOrCallback) {\n    \"use strict\";\n\n    var time;\n\n    var options = {\n        interval:     4,\n        minNeighbors: 1,\n        grayscale:    true,\n        confidence:   null,\n        async:        false,\n        complete:     function () {}, // (faces)\n        error:        function () {}  // (code, message)\n    };\n\n    if ($.isFunction(settingsOrCallback)) {\n        options.complete = settingsOrCallback;\n    } else {\n        $.extend(options, settingsOrCallback);\n    }\n\n    return this.each(function() {\n        var $$       = $(this),\n            offset   = $$.offset(),\n            position = $$.position(),\n            scaleX   = ($$.width()  / (this.naturalWidth  || this.videoWidth )) || 1,\n            scaleY   = ($$.height() / (this.naturalHeight || this.videoHeight)) || 1;\n\n        if (!$$.is('img, video, canvas')) {\n            options.error.apply($$, [ 1, 'Face detection is possible on images, videos and canvas only.' ]);\n            options.complete.apply($$, [ [] ]);\n            \n            return;\n        }\n\n        function detect() {\n            var source, canvas;\n            \n            time = new Date().getTime();\n\n            if ($$.is('img')) {\n                source = new Image();\n                source.src = $$.attr('src');\n                source.crossOrigin = $$.attr('crossorigin');\n\n                canvas = ccv.pre(source);\n            } else if ($$.is('video') || $$.is('canvas')) {\n                var copy, context;\n\n                source = $$[0];\n                \n                copy = document.createElement('canvas');\n                copy.setAttribute('width',  source.videoWidth  || source.width);\n                copy.setAttribute('height', source.videoHeight || source.height);\n                \n                context = copy.getContext(\"2d\");\n                context.drawImage(source, 0, 0);\n\n                canvas = ccv.pre(copy);\n            } \n\n            if (options.grayscale) {\n                canvas = ccv.grayscale(canvas);\n            }\n\n            try {\n                if (options.async && window.Worker) {\n                    ccv.detect_objects({\n                        \"canvas\":        canvas,\n                        \"cascade\":       cascade,\n                        \"interval\":      options.interval,\n                        \"min_neighbors\": options.minNeighbors,\n                        \"worker\":        1,\n                        \"async\":         true\n                    })(done);\n                } else {\n                    done(ccv.detect_objects({\n                        \"canvas\":        canvas,\n                        \"cascade\":       cascade,\n                        \"interval\":      options.interval,\n                        \"min_neighbors\": options.minNeighbors\n                    }));\n                }\n            } catch (e) {\n                options.error.apply($$, [ 2, e.message ]);\n                options.complete.apply($$, [ false ]);\n            }\n        }\n\n        function done(faces) {\n            var n = faces.length,\n                data = [];\n\n            for (var i = 0; i < n; ++i) {\n                if (options.confidence !== null && faces[i].confidence <= options.confidence) {\n                    continue;\n                }\n\n                faces[i].positionX = position.left + faces[i].x;\n                faces[i].positionY = position.top  + faces[i].y;\n                faces[i].offsetX   = offset.left   + faces[i].x;\n                faces[i].offsetY   = offset.top    + faces[i].y;\n                faces[i].scaleX    = scaleX;\n                faces[i].scaleY    = scaleY;\n\n                data.push(faces[i]);\n            }\n\n            data.time = new Date().getTime() - time;\n\n            options.complete.apply($$, [ data ]);\n        }\n\n        return detect();\n    });\n};\n"]},"metadata":{},"sourceType":"module"}