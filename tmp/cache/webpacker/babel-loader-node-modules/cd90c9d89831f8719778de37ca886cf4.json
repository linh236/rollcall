{"ast":null,"code":"$(document).ready(function () {\n  var lat = '';\n  var lon = ''; // get location\n\n  function geoFindMe() {\n    function success(position) {\n      var latitude = position.coords.latitude;\n      var longitude = position.coords.longitude;\n      lat = \"\".concat(latitude);\n      lon = \"\".concat(longitude);\n    }\n\n    function error() {\n      status.textContent = 'Unable to retrieve your location';\n    }\n\n    if (!navigator.geolocation) {\n      alert('Geolocation is not supported by your browser');\n    } else {\n      navigator.geolocation.getCurrentPosition(success, error);\n    }\n  } // ========================================\n\n\n  function configure() {\n    Webcam.set({\n      width: 320,\n      height: 240,\n      image_format: 'jpeg',\n      jpeg_quality: 90\n    });\n    Webcam.attach('#my_camera');\n  }\n\n  function capture_webcam() {\n    Webcam.snap(function (data_uri) {\n      // display results in page\n      document.getElementById('results').innerHTML = '<img id=\"imageprev\" src=\"' + data_uri + '\"/>';\n    });\n  }\n\n  function savePic() {\n    // Get base64 value from <img id='imageprev'> source\n    var base64image = document.getElementById(\"imageprev\").src;\n    var s = Convert.ToBase64String(base64image);\n    return s; // Webcam.upload( base64image, '/places', function(code, text) {\n    //  console.log('Save successfully');\n    //  // console.log(text);\n    // });\n\n    return s;\n  } // ==========================================================\n\n\n  $(\"#rollcall\").click(function () {\n    configure();\n    var picture = savePic();\n    console.log(picture);\n    rollcallData = {\n      place: {\n        lat: lat,\n        lon: lon,\n        ip: gon.ip,\n        picture: picture\n      }\n    };\n\n    if (lat == '' && lon == '') {\n      $.confirm({\n        title: false,\n        offsetTop: 20,\n        columnClass: \"col-md-6 col-md-offset-3 popup-rollcall\",\n        content: 'You should turn on GPS!',\n        closeIcon: true,\n        buttons: {\n          Cancel: {\n            btnClass: \"btn-red\",\n            action: function action() {\n              alert('Roll call failed !');\n            }\n          },\n          Confirm: {\n            btnClass: \"btn-blue\",\n            action: function action() {\n              geoFindMe();\n              alert('Turn on GPS success. Please Roll call again !');\n            }\n          }\n        }\n      });\n    } else {\n      return $.ajax({\n        type: \"POST\",\n        url: \"/places\",\n        data: rollcallData\n      }).done(function (response) {\n        console.log(rollcallData);\n        alert(\"Roll call susccess.\");\n        location.reload();\n      }).fail(function (response) {});\n    }\n  });\n  $(\"#turnon\").click(function () {\n    configure();\n  });\n  $(\"#capture\").click(function () {\n    capture_webcam();\n  });\n  $(\"#save\").click(function () {\n    console.log(savePic());\n  });\n});","map":{"version":3,"sources":["/home/lihn/rollcall/app/javascript/packs/places.js"],"names":["$","document","ready","lat","lon","geoFindMe","success","position","latitude","coords","longitude","error","status","textContent","navigator","geolocation","alert","getCurrentPosition","configure","Webcam","set","width","height","image_format","jpeg_quality","attach","capture_webcam","snap","data_uri","getElementById","innerHTML","savePic","base64image","src","s","Convert","ToBase64String","click","picture","console","log","rollcallData","place","ip","gon","confirm","title","offsetTop","columnClass","content","closeIcon","buttons","Cancel","btnClass","action","Confirm","ajax","type","url","data","done","response","location","reload","fail"],"mappings":"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","sourcesContent":["$(document).ready(function(){\n  var lat = '';\n  var lon = '';\n  // get location\n  function geoFindMe(){\n    function success(position){\n      const latitude  = position.coords.latitude;\n      const longitude = position.coords.longitude;\n      lat = `${latitude}`;\n      lon = `${longitude}`;\n    }\n    function error(){\n      status.textContent = 'Unable to retrieve your location';\n    }\n    if(!navigator.geolocation){\n      alert('Geolocation is not supported by your browser');\n    }else{\n      navigator.geolocation.getCurrentPosition(success, error);\n    }\n  }\n\n  // ========================================\n  function configure(){\n   Webcam.set({\n    width: 320,\n    height: 240,\n    image_format: 'jpeg',\n    jpeg_quality: 90\n   });\n   Webcam.attach( '#my_camera' );\n  }\n  function capture_webcam() {\n\n   Webcam.snap( function(data_uri) {\n   // display results in page\n   document.getElementById('results').innerHTML =\n    '<img id=\"imageprev\" src=\"'+data_uri+'\"/>';\n   } );\n  }\n\n function savePic(){\n  // Get base64 value from <img id='imageprev'> source\n  var base64image = document.getElementById(\"imageprev\").src;\n       var s = Convert.ToBase64String(base64image);\n       return s;\n  // Webcam.upload( base64image, '/places', function(code, text) {\n  //  console.log('Save successfully');\n  //  // console.log(text);\n  // });\n  return s;\n\n }\n // ==========================================================\n $(\"#rollcall\").click(function(){\n   configure();\n   var picture = savePic();\n   console.log(picture);\n   rollcallData = {\n     place:{\n       lat: lat,\n       lon: lon,\n       ip: gon.ip,\n       picture: picture,\n     }\n   };\n   if(lat == ''&& lon == ''){\n       $.confirm({\n       title: false,\n       offsetTop: 20,\n       columnClass: \"col-md-6 col-md-offset-3 popup-rollcall\",\n       content: 'You should turn on GPS!',\n       closeIcon: true,\n       buttons: {\n         Cancel:{\n           btnClass: \"btn-red\",\n           action: function(){\n             alert('Roll call failed !');\n           }\n         },\n         Confirm: {\n           btnClass: \"btn-blue\",\n           action: function(){\n             geoFindMe();\n             alert('Turn on GPS success. Please Roll call again !');\n           }\n         },\n       }\n     });\n   }else{\n     return $.ajax({\n       type: \"POST\",\n       url: \"/places\",\n       data: rollcallData,\n     }).done(function (response){\n       console.log(rollcallData);\n       alert(\"Roll call susccess.\");\n       location.reload();\n     }).fail(function(response){\n     });\n   }\n })\n   $(\"#turnon\").click(function(){\n     configure();\n   });\n   $(\"#capture\").click(function(){\n     capture_webcam();\n   });\n   $(\"#save\").click(function(){\n     console.log(savePic());\n   });\n});\n"]},"metadata":{},"sourceType":"module"}