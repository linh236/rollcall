{"ast":null,"code":"$(document).ready(function () {\n  var lat = '';\n  var lon = '';\n  geoFindMe(); // get location\n\n  function geoFindMe() {\n    function success(position) {\n      var latitude = position.coords.latitude;\n      var longitude = position.coords.longitude;\n      lat = \"\".concat(latitude);\n      lon = \"\".concat(longitude);\n    }\n\n    function error() {\n      status.textContent = 'Unable to retrieve your location';\n    }\n\n    if (!navigator.geolocation) {\n      alert('Geolocation is not supported by your browser');\n    } else {\n      navigator.geolocation.getCurrentPosition(success, error);\n    }\n  } // ========================================\n\n\n  function configure() {\n    Webcam.set({\n      width: 250,\n      height: 200,\n      image_format: 'jpeg',\n      jpeg_quality: 90\n    });\n    Webcam.attach('#my_camera');\n  }\n\n  function capture_webcam() {\n    Webcam.snap(function (data_uri) {\n      // display results in page\n      document.getElementById('results').innerHTML = '<img id=\"imageprev\" src=\"' + data_uri + '\"/>';\n    });\n  }\n\n  function savePic() {\n    var base64image = document.getElementById(\"imageprev\").src;\n    return base64image;\n  } // ==========================================================\n\n\n  $(\"#rollcall\").click(function () {\n    configure();\n    var course_id = $(this).data(\"course_id\");\n    var picture = savePic();\n    rollcallData = {\n      place: {\n        lat: lat,\n        lon: lon,\n        ip: gon.ip,\n        picture: picture,\n        user_id: gon.current_user_id,\n        course_id: course_id\n      }\n    }; // if(lat == ''&& lon == ''){\n    //     $.confirm({\n    //     title: false,\n    //     offsetTop: 20,\n    //     columnClass: \"col-md-6 col-md-offset-3 popup-rollcall\",\n    //     content:  \"#{I18n.t 'hello'}\",\n    //     closeIcon: true,\n    //     buttons: {\n    //       Cancel:{\n    //         btnClass: \"btn-red\",\n    //         action: function(){\n    //           console.log('Roll call failed !');\n    //           location.reload();\n    //         }\n    //       },\n    //       Confirm: {\n    //         btnClass: \"btn-blue\",\n    //         action: function(){\n    //          $.confirm({\n    //              title: 'NOTE',\n    //              content: 'Turn on GPS success. Please Roll call again !',\n    //              confirm: function(){\n    //                geoFindMe();\n    //              },\n    //              cancel: function(){\n    //              }\n    //          });\n    //         }\n    //       },\n    //     }\n    //   });\n    // }else{\n\n    return $.ajax({\n      type: \"POST\",\n      url: \"/places\",\n      data: rollcallData\n    }).done(function (response) {\n      if (response['data'] == 2) {\n        $.dialog({\n          title: 'NOTE',\n          content: 'You checked in'\n        });\n        location.reload();\n      } else {\n        $.dialog({\n          title: 'NOTE',\n          content: 'Success'\n        }); // location.reload();\n      }\n    }).fail(function (response) {}); // }\n  }); // $(\"#turnon\").click(function(){\n  //   configure();\n  // });\n\n  $(\"#capture\").click(function () {\n    capture_webcam();\n  });\n});","map":{"version":3,"sources":["/home/lihn/rollcall/app/javascript/packs/places.js"],"names":["$","document","ready","lat","lon","geoFindMe","success","position","latitude","coords","longitude","error","status","textContent","navigator","geolocation","alert","getCurrentPosition","configure","Webcam","set","width","height","image_format","jpeg_quality","attach","capture_webcam","snap","data_uri","getElementById","innerHTML","savePic","base64image","src","click","course_id","data","picture","rollcallData","place","ip","gon","user_id","current_user_id","ajax","type","url","done","response","dialog","title","content","location","reload","fail"],"mappings":"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","sourcesContent":["$(document).ready(function(){\n  var lat = '';\n  var lon = '';\n  geoFindMe();\n  // get location\n  function geoFindMe(){\n    function success(position){\n      const latitude  = position.coords.latitude;\n      const longitude = position.coords.longitude;\n      lat = `${latitude}`;\n      lon = `${longitude}`;\n    }\n    function error(){\n      status.textContent = 'Unable to retrieve your location';\n    }\n    if(!navigator.geolocation){\n      alert('Geolocation is not supported by your browser');\n    }else{\n      navigator.geolocation.getCurrentPosition(success, error);\n    }\n  }\n\n  // ========================================\n  function configure(){\n   Webcam.set({\n    width: 250,\n    height: 200,\n    image_format: 'jpeg',\n    jpeg_quality: 90\n   });\n   Webcam.attach( '#my_camera' );\n  }\n  function capture_webcam() {\n\n   Webcam.snap( function(data_uri) {\n   // display results in page\n   document.getElementById('results').innerHTML =\n    '<img id=\"imageprev\" src=\"'+data_uri+'\"/>';\n   } );\n  }\n\n function savePic(){\n\n  var base64image = document.getElementById(\"imageprev\").src;\n\n  return base64image;\n }\n // ==========================================================\n $(\"#rollcall\").click(function(){\n   configure();\n   var course_id = $(this).data(\"course_id\");\n   var picture = savePic();\n   rollcallData = {\n     place:{\n       lat: lat,\n       lon: lon,\n       ip: gon.ip,\n       picture: picture,\n       user_id: gon.current_user_id,\n       course_id: course_id,\n     }\n   };\n   // if(lat == ''&& lon == ''){\n   //     $.confirm({\n   //     title: false,\n   //     offsetTop: 20,\n   //     columnClass: \"col-md-6 col-md-offset-3 popup-rollcall\",\n   //     content:  \"#{I18n.t 'hello'}\",\n   //     closeIcon: true,\n   //     buttons: {\n   //       Cancel:{\n   //         btnClass: \"btn-red\",\n   //         action: function(){\n   //           console.log('Roll call failed !');\n   //           location.reload();\n   //         }\n   //       },\n   //       Confirm: {\n   //         btnClass: \"btn-blue\",\n   //         action: function(){\n   //          $.confirm({\n   //              title: 'NOTE',\n   //              content: 'Turn on GPS success. Please Roll call again !',\n   //              confirm: function(){\n   //                geoFindMe();\n   //              },\n   //              cancel: function(){\n   //              }\n   //          });\n   //         }\n   //       },\n   //     }\n   //   });\n   // }else{\n     return $.ajax({\n       type: \"POST\",\n       url: \"/places\",\n       data: rollcallData,\n     }).done(function (response){\n       if(response['data'] == 2){\n         $.dialog({\n            title: 'NOTE',\n            content: 'You checked in',\n        });\n         location.reload();\n       }else{\n         $.dialog({\n            title: 'NOTE',\n            content: 'Success',\n        });\n         // location.reload();\n       }\n     }).fail(function(response){\n     });\n   // }\n })\n   // $(\"#turnon\").click(function(){\n   //   configure();\n   // });\n   $(\"#capture\").click(function(){\n     capture_webcam();\n   });\n});\n"]},"metadata":{},"sourceType":"module"}